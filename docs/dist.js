"use strict";(()=>{var{console:Ve,queueMicrotask:We}=globalThis,y=(e,t=oe,r)=>({type:e,props:t,key:r}),P=y;var oe={},ye={},Be=y(ye,oe),be={},_e=[],He="http://www.w3.org/2000/svg",Xe=e=>Ve.error(e),ve=e=>e==null||e===!1||e==="",N=e=>typeof e=="function",qe=e=>Array.isArray(e),T=e=>typeof e=="object"&&e!==null,we=e=>e.children,Q=e=>e.children,Ee=e=>(x.catch=e.catch,e.children),xe=e=>{let t=Object.assign(({value:r,children:o})=>{let s=x,f=k(()=>{let n={deps:new Set,value:r};return s.contexts=new Map(s.contexts).set(t,n),n});if(r!==f.value){f.value=r;for(let n of f.deps){n.state=1;let{parent:c}=n;for(;c&&c!==s&&!c.state;)c.state=2,{parent:c}=c}}return o},{value:e});return t},Ye=(e,t,r)=>N(e)||e===ye?null:e===be?r.ownerDocument.createTextNode(t.nodeValue):r.ownerDocument.createElementNS(e==="svg"?He:"namespaceURI"in r?r.namespaceURI:r.host.namespaceURI,e),Ge=e=>e.nodeType===e.TEXT_NODE,me=(e,t)=>t in e&&(e[t]==null||!T(e[t])),ge=(e,t,r)=>{if(Ge(e)){e.nodeValue=r.nodeValue;return}for(let o in t)if(!(o==="children"||o in r))if(o==="ref")t.ref&&(t.ref.current=null);else if(o==="dataset"){let s=T(t[o])?t[o]:{};for(let f in s)delete e.dataset[f]}else me(e,o)?e[o]="":e.removeAttribute(o);for(let o in r)if(!(o==="children"||t[o]===r[o]))if(o==="ref")t.ref&&(t.ref.current=null),r.ref&&(r.ref.current=e);else if(o==="dataset"){let s=T(r[o])?r[o]:{};for(let f in s)s[f]!=null&&(e.dataset[f]=s[f])}else if(o==="style"&&T(r[o])){let{style:s}=e,f=T(t[o])?t[o]:{},n=r[o];for(let c in f)c in n||(s[c]="");for(let c in n)s[c]=n[c]??""}else me(e,o)?e[o]=r[o]??"":r[o]!=null?e.setAttribute(o,r[o]):e.removeAttribute(o)},x=null,q=0,Y=0,K=e=>{let t=x;t.refs??=[];let r=t.refs[Y++];return r||(r={current:N(e)?e():e},t.refs.push(r)),r},z=(e,t)=>{let r=x;r.effects??=[];let o=r.effects[q++];o?(!o.deps||!t||Se(o.deps,t))&&(o.after=e,o.deps=t):r.effects.push({before:void 0,after:e,deps:t})},k=(e,t=_e)=>{let r=K(()=>({value:e(),deps:t}));return Se(r.current.deps,t)&&(r.current.value=e(),r.current.deps=t),r.current.value},F=e=>{let t=x,r=k(()=>[N(e)?e():e,o=>{let s=N(o)?o(r[0]):o;return s!==r[0]&&(r[0]=s,Ze(t)),s}]);return[...r]},Se=(e,t)=>{if(e===t)return!1;let{length:r}=e;if(r!==t.length)return!0;for(;r--;)if(e[r]!==t[r])return!0;return!1},O=e=>{let t=K(()=>e);return t.current=e,k(()=>(...r)=>t.current(...r))},Je=(e,t)=>{if(e===t)return!0;for(let r in e)if(e[r]!==t[r])return!1;for(let r in t)if(!(r in e))return!1;return!0},ne=(e,t=Je)=>(e.memo=t,e),se=e=>{let t=x,r=t.contexts?.get(e);return z(()=>{if(r)return r.deps.add(t),()=>r.deps.delete(t)},[r,t]),(r??e).value},Qe=(e,t)=>{for(;e.depth>t.depth;)if(e=e.parent,e===t)return 1;for(;t.depth>e.depth;)if(t=t.parent,t===e)return-1;for(;e.parent!==t.parent;)e=e.parent,t=t.parent;return e.index-t.index},Ze=e=>{if(e.state===1||e.state===3)return;let{queues:t}=e,{updates:r}=t;r.length===0&&We(()=>{let o=r.sort(Qe);t.updates=[];for(let s=0;s<o.length;++s){let f=o[s];f.state===1&&J(f)}G(t)}),r.push(e),e.state=1},Ie=e=>{let{children:t}=e.props;if(N(e.type)){let r=[x,q,Y];x=e,q=0,Y=0;try{t=e.type(e.props)}catch(o){t=null,e.catch(o)}finally{[x,q,Y]=r}}return ve(t)?[]:qe(t)?t:[t]},et=e=>ve(e)?Be:Array.isArray(e)?y(we,{children:e}):T(e)&&Object.keys(e).length===3&&(typeof e.type=="string"||N(e.type))&&T(e.props)&&"key"in e?e:y(be,{nodeValue:e}),Ce=e=>{let{child:t,state:r}=e;if(r===1)J(e);else if(r===2)for(e.state=0;t;t=t.sibling)Ce(t)},re=({child:e,node:t})=>{if(t)return[t];let r=[];for(;e;e=e.sibling)r.push(...re(e));return r},J=e=>{let{depth:t,queues:r}=e,{afterEffects:o,inserts:s,moves:f,nodeUpdates:n}=r;if(e.effects)try{for(let i=0;i<e.effects.length;++i){let a=e.effects[i];a.after&&a.before&&(a.before(),a.before=void 0)}}catch(i){e.catch(i)}let c=e.child,u=c&&new Map;for(;c;c=c.sibling)u.set(c.key??c.index,c);let m=e.node??e.parentNode,d=Ie(e);e.state=0,e.child=null;let M=e.node?null:e.prevNode;for(let i=0,a=null;i<d.length;++i){let{type:h,props:p,key:v}=et(d[i]),l=u?.get(v??i),R=!1,E=null,w=!1;if(l?.type===h)u.delete(v??i),l.index=i,l.sibling=null,(!N(l.type)||!l.type.memo?.(l.props,p))&&(l.node&&(E=[l.node,l.props,p]),l.props=p,l.state=1),l.parentNode===m&&l.lastNode&&M!==l.prevNode&&(R=!0);else{try{l={catch:e.catch,child:null,contexts:e.contexts,depth:t+1,effects:null,index:i,key:v,lastNode:null,node:Ye(h,p,m),parent:e,props:p,queues:r,refs:null,sibling:null,state:1,type:h,...h===Q?{parentNode:p.to,prevNode:p.to.lastChild}:{parentNode:m,prevNode:M}}}catch(g){e.catch(g);continue}l.node&&(w=!0)}l.parentNode===m&&(l.prevNode=M),a?a.sibling=l:e.child=l,Ce(l),R&&f.push(l),E&&n.push(E),w&&s.push(l),l.parentNode===m&&l.lastNode&&(M=l.lastNode),a=l}if(e.lastNode=e.node??M??null,u)for(let i of u.values())ce(i);e.effects&&o.push(e)},ce=(e,t=!0)=>{e.state=3;let{effects:r,child:o,node:s}=e;if(r)try{for(let n=0;n<r.length;++n){let c=r[n];c.before&&(c.before(),c.before=void 0)}}catch(n){e.catch(n)}let f=t&&!s;for(;o;o=o.sibling)ce(o,f||o.type===Q);t&&s&&e.queues.removes.unshift(s)},G=e=>{let{afterEffects:t,inserts:r,moves:o,nodeUpdates:s,removes:f}=e;for(let n=f.length-1;n>=0;--n)f[n].remove();e.removes=[];for(let n=0;n<o.length;++n){let c=o[n],{parentNode:u,prevNode:m}=c;m?m.after(...re(c)):u.prepend(...re(c))}e.moves=[];for(let n=0;n<r.length;++n){let{node:c,parentNode:u,prevNode:m,props:d}=r[n];ge(c,oe,d),m?m.after(c):u.prepend(c)}e.inserts=[];for(let n=0;n<s.length;++n)ge(...s[n]);e.nodeUpdates=[];for(let n=0;n<t.length;++n){let c=t[n],u=c.effects;try{for(let m=0;m<u.length;++m){let d=u[m];d.after&&(d.before=d.after(),d.after=void 0)}}catch(m){c.catch(m)}}e.afterEffects=[]},ke=e=>{let t={afterEffects:[],inserts:[],moves:[],nodeUpdates:[],removes:[],updates:[]},r={catch:Xe,child:null,contexts:null,depth:0,effects:null,index:0,key:void 0,lastNode:null,node:null,parent:null,parentNode:e,prevNode:e.lastChild,props:{},queues:t,refs:null,sibling:null,state:1,type:we};return J(r),G(t),{render:o=>{r.props={children:o},J(r),G(t)},unmount:()=>{ce(r),G(t)}}};var{document:U,getComputedStyle:tt,Document:Me,ResizeObserver:Re,window:Te,Window:rt}=globalThis,{body:Ne}=U,ot=U.scrollingElement,V=Te.visualViewport??Te,nt=10,st={x:"clientWidth",y:"clientHeight"},ct={x:"innerWidth",y:"innerHeight"},lt={x:"overflowX",y:"overflowY"},le={x:"right",y:"bottom"},Pe={x:"width",y:"height"},it={x:"scrollWidth",y:"scrollHeight"},at={x:"scrollLeft",y:"scrollTop"},ft=({axis:e,el:t})=>{for(;(t&&=t.parentElement)&&!(t===Ne||!Ne.contains(t));){if(t[it[e]]<=t[st[e]])continue;let r=tt(t)[lt[e]];if(r==="scroll"||r==="auto")return t}return U},ze=({axis:e="y",containerRef:t,growBuffer:r=200,length:o=0,minIndex:s=0,shrinkBuffer:f=r+200})=>{let n=k(()=>({cache:{},columns:1,isRendering:!1,observed:null,observer:null,prev:{cache:{},minIndex:s,start:s},scrollParent:null,scrollTarget:null,syncUpdateCount:0,resolve:()=>{n.scrollTarget=null,n.syncUpdateCount=0}})),c=O(()=>{if(n.isRendering)return;let i=t.current,{end:a,start:h}=d;if(!i||h===a||i.children.length!==a-h)return n.resolve();let{cache:p,prev:v,scrollTarget:l}=n,R=d.start,E=[],w,g=1;for(let b of i.children){let de=b.getBoundingClientRect(),pe=de[Pe[e]];p[R++]=pe,E.push(pe);let he=de[e];w==null?w=he:he===w&&++g}let $e=E.sort()[Math.floor(E.length/2)];n.columns=g;let C=ft({axis:e,el:i});C!==n.scrollParent&&(n.scrollParent!==U&&n.scrollParent?.removeEventListener("scroll",c),C!==U&&C.addEventListener("scroll",c),n.scrollParent=C);let j=C instanceof Me?ot:C,A=at[e],Z=0,Ke=Math.min(v.minIndex,s),Fe=Math.max(v.start,d.start);for(let b=Ke;b<Fe;b+=g)Z+=(p[b]??0)-(v.cache[b]??0);if(Z&&(j[A]+=Z),n.prev={cache:{...p},minIndex:s,start:d.start},n.syncUpdateCount++>nt)return n.resolve();let I=i.getBoundingClientRect(),W=I[e]+d.before,B=I[le[e]]-d.after,ae=C instanceof Me?{[e]:0,[le[e]]:V instanceof rt?V[ct[e]]:V[Pe[e]]}:C.getBoundingClientRect(),_=ae[e],ee=ae[le[e]],te=s+o;for(let b=s;b<te;++b)p[b]??=$e;h-=(h-s)%g;let fe=(a-s)%g;for(fe&&(a+=g-fe);h-g>=s&&W>_-r;)W-=p[h-g],h-=g;for(;h<te&&W+p[h]<=_-f;)W+=p[h],h+=g;for(;a<te&&B<ee+r;)B+=p[a],a+=g;for(;a-g>=s&&B-p[a-g]>=ee+f;)B-=p[a-g],a-=g;let L=m({end:a,start:h});if(L.after!==d.after||L.before!==d.before||L.end!==d.end||L.start!==d.start)return n.isRendering=!0,M(L);if(!l)return n.resolve();let{index:D}=l;D=Math.min(s+o-1,Math.max(D,s)),D-=(D-s)%g;let ue=0;for(let b=s;b<D;b+=g)ue+=p[b];let H=j[A],Oe=p[D],$=I[e]+H-_+ue-l.buffer,X=$-(ee-_)+Oe+l.buffer*2;l.align==="nearest"&&($<X?l.align="center":H>$?l.align="start":H<X&&(l.align="end")),l.align==="start"?j[A]=$:l.align==="end"?j[A]=X:l.align==="center"&&(j[A]=($+X)/2),j[A]===H?n.resolve():c()}),u=O(({align:i="nearest",buffer:a=0,index:h})=>{n.scrollTarget={align:i,buffer:a,index:h},c()}),m=({end:i,start:a})=>{if(r===1/0)return{after:0,before:0,end:s+o,scrollTo:u,start:s};let{cache:h,columns:p}=n,v=s+o;a-=(a-s)%p,a=Math.min(v,Math.max(a,s));let l=(i-s)%p;l&&(i+=p-l),i=Math.min(v,Math.max(i,a)),i-a<=p&&(i<v?i=Math.min(v,i+p):a>s&&(a-=p));let R=0,E=0;for(let w=s;w<v;w+=p)w<a?R+=h[w]??0:w>=i&&(E+=h[w]??0);return{after:E,before:R,end:i,scrollTo:u,start:a}},[d,M]=F({after:0,before:0,end:0,scrollTo:u,start:0});return k(()=>{Object.assign(d,m({end:d.end,start:d.start}))},[o,s]),n.observer??=Re&&new Re(c),z(()=>{let{observed:i,observer:a}=n,h=t.current;a&&i!==h&&(i&&a.unobserve(i),h&&a.observe(h),n.observed=h),n.isRendering=!1,c()}),z(()=>{let{observer:i}=n;return V.addEventListener("resize",c),U.addEventListener("scroll",c),()=>{i?.disconnect(),V.removeEventListener("resize",c),U.removeEventListener("scroll",c),n.scrollParent?.removeEventListener("scroll",c)}},[n,c]),d};var{clearTimeout:Ue,document:De,setTimeout:je,setInterval:ut}=globalThis,S=10,dt=({children:e})=>{if(Math.random()<.005)throw new Error("red");return z(()=>{if(Math.random()<.005)throw new Error("blue");return()=>{if(Math.random()<.5)throw new Error("yellow")}}),e},pt=ne(()=>P("div",{style:{background:"#fff9",borderRadius:"0.25rem",padding:"1rem"},children:["Portal: ",se(ie)]})),ht=ne(({x:e,y:t})=>{let r=se(ie),o=k(()=>`rgb(${128+(e-t)/S*128}, ${128+(t-e)/S*128}, ${(e+t)/S/2*256})`),s=K(void 0),[f,n]=F("black"),c=O(()=>{n(o),Ue(s.current),s.current=je(()=>n("black"),5e3)}),u=1+Math.floor(Math.random()*10);return y(Ee,{catch:m=>{n(m.message),Ue(s.current),s.current=je(()=>n("black"),5e3)},children:P("div",{onpointerdown:c,onpointermove:c,style:{alignItems:"center",backgroundColor:f,borderRadius:"0.25rem",display:"flex",fontSize:"0.75rem",flexDirection:"column",gap:"0.25rem",justifyContent:"center",minWidth:"0",overflow:"hidden",padding:"0.25rem",textAlign:"center",transition:f==="black"?"all 5s":""},children:[y("select",{value:(Math.floor(Math.random()*u)+1).toString(),children:Array.from({length:u},(m,d)=>y("option",{value:(d+1).toString(),children:d+1},d))}),f==="red"?"Fake Render Error":f==="blue"?"Fake After Effect Error":f==="yellow"?"Fake Before Effect Error":y(dt,{children:r}),e===0&&t===0&&!!(r%5)&&y(Q,{to:De.getElementById("portal"),children:y(pt,{})})]})})}),ie=xe(0),Ae=1e4,mt=()=>{let[e,t]=F(new Date().getSeconds());z(()=>{ut(()=>t(new Date().getSeconds()),1e3)},[]);let r=K(null),{start:o,end:s,before:f,after:n}=ze({containerRef:r,length:Ae});return P(ie,{value:e,children:[y("div",{style:{boxSizing:"border-box",cursor:"crosshair",display:"grid",gap:"0.25rem",gridTemplate:`repeat(${S}, 1fr) / repeat(${S}, 1fr)`,height:"100%",padding:"0.25rem"},children:Array.from({length:S*S},(c,u)=>y(ht,{x:u%S,y:Math.floor(u/S)},u))}),P("div",{style:{padding:"1rem"},children:[P("div",{style:{color:"#fff",fontWeight:"bold",marginBottom:"0.5rem"},children:[Ae," Items"]}),y("div",{dataset:{listContainer:"true"},ref:r,style:{color:"white",paddingTop:`${f}px`,paddingBottom:`${n}px`,display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(min(200px, 50%), 1fr))",borderLeft:"10px solid #000",borderBottom:"10px solid #000"},children:Array.from({length:s-o},(c,u)=>P("div",{style:{borderTop:"10px solid #000",borderRight:"10px solid #000",padding:"1rem",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",backgroundColor:`rgb(${(o+u)*13%128}, ${(o+u)*19%128}, ${(o+u)*23%128})`},children:["Item ",u+o+1]},u+o))})]}),y("button",{onclick:Le.unmount,style:{position:"fixed",bottom:"1rem",right:"1rem"},children:"Unmount"})]})},Le=ke(De.getElementById("root").attachShadow({mode:"open"}));Le.render(y(mt,{}));})();
