"use strict";(()=>{var{console:ne,document:B,queueMicrotask:oe,Text:se}=globalThis,a=(e,t=G,r)=>({type:e,props:t,key:r}),E=a;var q=e=>e.children,T=e=>e.children,O=e=>(d.catch=e.catch,e.children),W=()=>{let e=({value:t,children:r})=>{let n=d,c=M(()=>{let f={deps:new Set,value:t};return n.contexts=new Map(n.contexts).set(e,f),f});if(t!==c.value){c.value=t;for(let f of c.deps){f.state=1;let{parent:o}=f;for(;o&&o!==n&&!o.state;)o.state=2,{parent:o}=o}}return r};return e},_=e=>e==null||e===!1||e==="",G={},H={},ce=a(H,G),J={},le=[],fe="http://www.w3.org/2000/svg",ie=e=>ne.error(e),ue=(e,t,r)=>{if(typeof e=="function"||e===H)return null;if(e===J)return B.createTextNode(t.nodeValue);let n=B.createElementNS(e==="svg"?fe:r.namespaceURI,e);return K(n,{},t),n},z=(e,t)=>t in e&&(e[t]==null||typeof e[t]!="object"),ae=(e,t,r)=>{for(let n in t)n in r||(e[n]="");for(let n in r)e[n]=r[n]??""},K=(e,t,r)=>{if(e instanceof se){e.nodeValue=r.nodeValue;return}for(let n in t)n==="children"||n in r||(n==="ref"?t.ref&&(t.ref.current=null):z(e,n)?e[n]="":e.removeAttribute(n));for(let n in r)n==="children"||t[n]===r[n]||(n==="ref"?(t.ref&&(t.ref.current=null),r.ref&&(r.ref.current=e)):n==="style"&&r[n]&&typeof r[n]=="object"?ae(e.style,t[n]&&typeof t[n]=="object"?t[n]:{},r[n]):z(e,n)?e[n]=r[n]??"":r[n]!=null?e.setAttribute(n,r[n]):e.removeAttribute(n))},d=null,w=0,k=0,S=e=>{let t=d;t.refs??=[];let r=t.refs[k++];return r||(r={current:e},t.refs.push(r)),r},j=(e,t)=>{let r=d;r.effects??=[];let n=r.effects[w++];n?(!n.deps||!t||L(n.deps,t))&&(n.after=e,n.deps=t):r.effects.push({before:void 0,after:e,deps:t})},M=(e,t=le)=>{let r=S(null);return r.current?L(r.current.deps,t)&&(r.current.value=e(),r.current.deps=t):r.current={value:e(),deps:t},r.current.value},I=e=>{let t=d,r=M(()=>[e,n=>{let c=typeof n=="function"?n(r[0]):n;return c===r[0]||(r[0]=c,he(t)),c}]);return r},L=(e,t)=>{let{length:r}=e;if(r!==t.length)return!0;for(;r--;)if(e[r]!==t[r])return!0;return!1};var pe=(e,t)=>{if(e===t)return!0;for(let r in e)if(e[r]!==t[r])return!1;for(let r in t)if(!(r in e))return!1;return!0},U=(e,t=pe)=>(e.memo=t,e),v=e=>{let t=d,r=t.contexts?.get(e);return j(()=>{if(r)return r.deps.add(t),()=>r.deps.delete(t)},[r,t]),r?.value},de=(e,t)=>{for(;e.depth>t.depth;)if(e=e.parent,e===t)return 1;for(;t.depth>e.depth;)if(t=t.parent,t===e)return-1;for(;e.parent!==t.parent;)e=e.parent,t=t.parent;return e.index-t.index},he=e=>{if(e.state===1||e.state===3)return;let{queues:t}=e,{updates:r}=t;r.length===0&&oe(()=>{let n=r.sort(de);t.updates=[];for(let c=0;c<n.length;++c){let f=n[c];f.state===1&&C(f)}x(t)}),r.push(e),e.state=1},me=e=>{let{children:t}=e.props;if(typeof e.type=="function"){let r=[d,w,k];d=e,w=0,k=0;try{t=e.type(e.props)}catch(n){t=null,e.catch(n)}[d,w,k]=r}return _(t)?[]:Array.isArray(t)?t:[t]},ye=e=>_(e)?ce:Array.isArray(e)?a(q,{children:e}):e&&typeof e=="object"&&Object.keys(e).length===3&&"type"in e&&(typeof e.type=="string"||typeof e.type=="function")&&"props"in e&&e.props&&typeof e.props=="object"&&"key"in e?e:a(J,{nodeValue:e}),Q=e=>{let{child:t,state:r}=e;if(r===1)C(e);else if(r===2)for(e.state=0;t;t=t.sibling)Q(t)},D=({child:e,node:t})=>{if(t)return[t];let r=[];for(;e;e=e.sibling)r.push(...D(e));return r},C=e=>{let{depth:t,queues:r}=e,{afterEffects:n,inserts:c,moves:f,nodeUpdates:o}=r;if(e.effects)try{for(let u=0;u<e.effects.length;++u){let m=e.effects[u];m.after&&m.before&&(m.before(),m.before=void 0)}}catch(u){e.catch(u)}let l=e.child,p=l&&new Map;for(;l;l=l.sibling)p.set(l.key??l.index,l);let i=e.node??e.parentNode,y=me(e);e.state=0,e.child=null;let b=e.node?null:e.prevNode;for(let u=0,m=null;u<y.length;++u){let{type:N,props:g,key:A}=ye(y[u]),s=p?.get(A??u),F=!1,R=null,$=!1;if(s?.type===N)p.delete(A??u),s.index=u,s.sibling=null,(typeof s.type!="function"||!s.type.memo?.(s.props,g))&&(s.node&&(R=[s.node,s.props,g]),s.props=g,s.state=1),s.parentNode===i&&s.lastNode&&b!==s.prevNode&&(F=!0);else{try{s={catch:e.catch,child:null,contexts:e.contexts,depth:t+1,effects:null,index:u,key:A,lastNode:null,node:ue(N,g,i),parent:e,props:g,queues:r,refs:null,sibling:null,state:1,type:N,...N===T?{parentNode:g.to,prevNode:g.to.lastChild}:{parentNode:i,prevNode:b}}}catch(re){e.catch(re);continue}s.node&&($=!0)}s.parentNode===i&&(s.prevNode=b),m?m.sibling=s:e.child=s,Q(s),F&&f.push(s),R&&o.push(R),$&&c.push(s),s.parentNode===i&&s.lastNode&&(b=s.lastNode),m=s}if(e.lastNode=e.node??b??null,p)for(let u of p.values())P(u);e.effects&&n.push(e)},P=(e,t=!0)=>{e.state=3;let{effects:r,child:n,node:c}=e;if(r)try{for(let o=0;o<r.length;++o){let l=r[o];l.before&&(l.before(),l.before=void 0)}}catch(o){e.catch(o)}let f=t&&!c;for(;n;n=n.sibling)P(n,f||n.type===T);t&&c&&e.queues.removes.unshift(c)},x=e=>{let{afterEffects:t,inserts:r,moves:n,nodeUpdates:c,removes:f}=e;for(let o=f.length-1;o>=0;--o)f[o].remove();e.removes=[];for(let o=0;o<n.length;++o){let l=n[o],{parentNode:p,prevNode:i}=l;i?i.after(...D(l)):p.prepend(...D(l))}e.moves=[];for(let o=0;o<c.length;++o)K(...c[o]);e.nodeUpdates=[];for(let o=0;o<r.length;++o){let{node:l,parentNode:p,prevNode:i}=r[o];i?i.after(l):p.prepend(l)}e.inserts=[];for(let o=0;o<t.length;++o){let l=t[o],p=l.effects;try{for(let i=0;i<p.length;++i){let y=p[i];y.after&&(y.before=y.after(),y.after=void 0)}}catch(i){l.catch(i)}}e.afterEffects=[]},X=e=>{let t={afterEffects:[],inserts:[],moves:[],nodeUpdates:[],removes:[],updates:[]},r={catch:ie,child:null,contexts:null,depth:0,effects:null,index:0,key:void 0,lastNode:null,node:null,parent:null,parentNode:e,prevNode:e.lastChild,props:{},queues:t,refs:null,sibling:null,state:1,type:q};return C(r),x(t),{render:n=>{r.props={children:n},C(r),x(t)},unmount:()=>{P(r),x(t)}}};var{clearTimeout:Y,document:ee,setTimeout:Z,setInterval:ge}=globalThis,h=10,be=({children:e})=>{if(Math.random()<.005)throw new Error("red");return j(()=>{if(Math.random()<.005)throw new Error("blue");return()=>{if(Math.random()<.5)throw new Error("yellow")}}),e},Ne=U(()=>E("div",{style:{background:"#fff9",borderRadius:"0.25rem",padding:"1rem"},children:["Portal: ",v(V)]})),we=U(({x:e,y:t})=>{let r=v(V)??0,n=M(()=>`rgb(${128+(e-t)/h*128}, ${128+(t-e)/h*128}, ${(e+t)/h/2*256})`),c=S(void 0),[f,o]=I("black");return a(O,{catch:l=>{o(l.message),Y(c.current),c.current=Z(()=>o("black"),5e3)},children:E("div",{onpointermove:()=>{o(n),Y(c.current),c.current=Z(()=>o("black"),5e3)},ontouchmove:l=>l.preventDefault(),style:{alignItems:"center",backgroundColor:f,borderRadius:"0.25rem",display:"flex",fontSize:"0.75rem",justifyContent:"center",minWidth:"0",overflow:"hidden",padding:"0.25rem",textAlign:"center",transition:f==="black"?"all 5s":""},children:[f==="red"?"Fake Render Error":f==="blue"?"Fake After Effect Error":f==="yellow"?"Fake Before Effect Error":a(be,{children:r}),e===0&&t===0&&!!(r%5)&&a(T,{to:ee.getElementById("portal"),children:a(Ne,{})})]})})}),V=W(),ke=()=>{let[e,t]=I(new Date().getSeconds());return j(()=>{ge(()=>t(new Date().getSeconds()),1e3)},[]),E(V,{value:e,children:[a("div",{style:{cursor:"crosshair",display:"grid",gap:"0.25rem",gridTemplate:`repeat(${h}, 1fr) / repeat(${h}, 1fr)`,height:"100%",padding:"0.25rem"},children:Array.from({length:h*h},(r,n)=>a(we,{x:n%h,y:Math.floor(n/h)},n))}),a("button",{onclick:te.unmount,style:{position:"fixed",bottom:"1rem",right:"1rem"},children:"Unmount"})]})},te=X(ee.getElementById("root"));te.render(a(ke,{}));})();
