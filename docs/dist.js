"use strict";(()=>{var{console:Oe,queueMicrotask:_e,Element:He}=globalThis,h=(e,t,r)=>({type:e,props:t,key:r}),S=h;var he={},me={},Xe=h(me,he),ge={},Ie=[],Ye="moveBefore"in He.prototype?"moveBefore":"insertBefore",qe="http://www.w3.org/2000/svg",Ge=e=>Oe.error(e),ye=e=>e==null||e===!1||e==="",N=e=>typeof e=="function",j=e=>typeof e=="object"&&e!==null,be=e=>e.children,K=e=>e.children,ve=e=>(E.catch=e.catch,e.children),we=e=>{let t=({value:r,children:o})=>{let s=E,d=T(()=>{let n={deps:new Set,value:r};return s.contexts=new Map(s.contexts).set(t,n),n});if(r!==d.value){d.value=r;for(let n of d.deps){n.state=1;let{parent:c}=n;for(;c&&c!==s&&!c.state;)c.state=2,{parent:c}=c}}return o};return t.value=e,t},Je=(e,t,r)=>N(e)||e===me?null:e===ge?r.ownerDocument.createTextNode(t.nodeValue):r.ownerDocument.createElementNS(e==="svg"?qe:"namespaceURI"in r?r.namespaceURI:r.host.namespaceURI,e),Qe=e=>e.nodeType===e.TEXT_NODE,de=(e,t)=>t in e&&(e[t]==null||!j(e[t])),pe=(e,t,r)=>{if(Qe(e)){e.nodeValue=r.nodeValue;return}for(let o in t)o==="children"||o in r||(o==="ref"?t.ref&&(t.ref.current=null):de(e,o)?e[o]="":e.removeAttribute(o));for(let o in r)if(!(o==="children"||t[o]===r[o]))if(o==="ref")t.ref&&(t.ref.current=null),r.ref&&(r.ref.current=e);else if(o==="style"&&j(r[o])){let{style:s}=e,d=j(t[o])?t[o]:{},n=r[o];for(let c in d)c in n||(s[c]="");for(let c in n)s[c]=n[c]??""}else de(e,o)?e[o]=r[o]??"":r[o]!=null?e.setAttribute(o,r[o]):e.removeAttribute(o)},E=null,Y=0,q=0,F=e=>{let t=E;t.refs??=[];let r=t.refs[q++];return r||(r={current:N(e)?e():e},t.refs.push(r)),r},z=(e,t)=>{let r=E;r.effects??=[];let o=r.effects[Y++];o?(!o.deps||!t||xe(o.deps,t))&&(o.after=e,o.deps=t):r.effects.push({before:void 0,after:e,deps:t})},T=(e,t=Ie)=>{let r=F(()=>({value:e(),deps:t}));return xe(r.current.deps,t)&&(r.current.value=e(),r.current.deps=t),r.current.value},L=e=>{let t=E,r=T(()=>[N(e)?e():e,o=>{let s=N(o)?o(r[0]):o;return s!==r[0]&&(r[0]=s,tt(t)),s}]);return r},xe=(e,t)=>{if(e===t)return!1;let{length:r}=e;if(r!==t.length)return!0;for(;r--;)if(e[r]!==t[r])return!0;return!1},V=e=>{let t=F(()=>e);return t.current=e,T(()=>(...r)=>t.current.apply(null,r))},Ze=(e,t)=>{if(e===t)return!0;for(let r in e)if(e[r]!==t[r])return!1;for(let r in t)if(!(r in e))return!1;return!0},G=(e,t=Ze)=>(e.memo=t,e),te=e=>{let t=E,r=t.contexts?.get(e);return z(()=>{if(r)return r.deps.add(t),()=>r.deps.delete(t)},[r,t]),(r??e).value},et=(e,t)=>{for(;e.depth>t.depth;)if(e=e.parent,e===t)return 1;for(;t.depth>e.depth;)if(t=t.parent,t===e)return-1;for(;e.parent!==t.parent;)e=e.parent,t=t.parent;return e.index-t.index},tt=e=>{if(e.state===1||e.state===3)return;let{queues:t}=e,{updates:r}=t;r.length===0&&_e(()=>{let o=r.sort(et);t.updates=[];for(let s of o)s.state===1&&re(s);Ce(t)}),r.push(e),e.state=1},rt=e=>{let{children:t}=e.props;if(N(e.type)){let r=[E,Y,q];E=e,Y=0,q=0;try{t=e.type(e.props)}catch(o){t=null,e.catch(o)}finally{[E,Y,q]=r}}return ye(t)?[]:Array.isArray(t)?t:[t]},ot=e=>ye(e)?Xe:Array.isArray(e)?h(be,{children:e}):j(e)&&Object.keys(e).length===3&&(typeof e.type=="string"||N(e.type))&&j(e.props)&&"key"in e?e:h(ge,{nodeValue:e}),Se=e=>{let{child:t,state:r}=e;if(r===1)re(e);else if(r===2)for(e.state=0;t;t=t.sibling)Se(t)},Ee=({child:e,node:t})=>{if(t)return[t];let r=[];for(;e;e=e.sibling)r.push.apply(r,Ee(e));return r},re=e=>{let{depth:t,queues:r}=e,{afterEffects:o,inserts:s,nodeUpdates:d}=r,n=e.child,c=n&&new Map;for(;n;n=n.sibling)c.set(n.key??n.index,n);let v=e.node??e.parentNode,y=rt(e);if(e.effects)try{for(let m of e.effects)m.after&&m.before&&(m.before(),m.before=void 0)}catch(m){e.catch(m)}e.state=0,e.child=null;let i=e.node?null:e.prevNode;for(let m=0,u=null;m<y.length;++m){let{type:a,props:f,key:p}=ot(y[m]),l=c?.get(p??m),g=null,C=!1;if(l?.type===a)c.delete(p??m),l.index=m,l.sibling=null,(!N(l.type)||!l.type.memo?.(l.props,f))&&(l.node&&(g=[l.node,l.props,f]),l.props=f,l.state=1),l.parentNode===v&&l.lastNode&&l.prevNode!==i&&(C=!0);else{try{l={catch:e.catch,child:null,contexts:e.contexts,depth:t+1,effects:null,index:m,key:p,lastNode:null,node:Je(a,f,v),parent:e,parentNode:a===K?f.to:v,prevNode:a===K?f.to.lastChild:i,props:f,queues:r,refs:null,sibling:null,state:1,type:a}}catch(R){e.catch(R);continue}l.node&&(C=!0)}l.parentNode===v&&(l.prevNode=i),u?u.sibling=l:e.child=l,Se(l),g&&d.push(g),C&&s.push(l),l.parentNode===v&&l.lastNode&&(i=l.lastNode),u=l}if(e.lastNode=e.node??i??null,c)for(let m of c.values())ke(m);e.effects&&o.push(e)},ke=(e,t=!0)=>{e.state=3;let{effects:r,child:o,props:s,node:d}=e;if(r)try{for(let c of r)c.before&&(c.before(),c.before=void 0)}catch(c){e.catch(c)}let n=t&&!d;for(;o;o=o.sibling)ke(o,n||o.type===K);d&&(s.ref&&(s.ref.current=null),t&&e.queues.removes.push(d))},Ce=e=>{for(let t of e.removes)t.remove();e.removes=[];for(let t of e.inserts){let{node:r,parentNode:o,prevNode:s,props:d}=t,n=s?s.nextSibling:o.firstChild;if(r&&!r.parentNode)pe(r,he,d),o.insertBefore(r,n);else for(let c of Ee(t)){if(c===n||c.nextSibling===n)break;o[Ye](c,n)}}e.inserts=[];for(let t of e.nodeUpdates)pe.apply(null,t);e.nodeUpdates=[];for(let t of e.afterEffects)try{for(let r of t.effects)r.after&&(r.before=r.after(),r.after=void 0)}catch(r){t.catch(r)}e.afterEffects=[]},Re=e=>{let t={catch:Ge,child:null,contexts:null,depth:0,effects:null,index:0,key:void 0,lastNode:null,node:null,parent:null,parentNode:e,prevNode:e.lastChild,props:{children:void 0},queues:{afterEffects:[],inserts:[],nodeUpdates:[],removes:[],updates:[]},refs:null,sibling:null,state:1,type:be};return r=>{t.props.children=r,re(t),Ce(t.queues)}};var{document:P,getComputedStyle:nt,Document:Me,ResizeObserver:Te,window:Ne,Window:st}=globalThis,{body:ze}=P,ct=P.scrollingElement,W=Ne.visualViewport??Ne,lt=10,it={x:"clientWidth",y:"clientHeight"},at={x:"innerWidth",y:"innerHeight"},ft={x:"overflowX",y:"overflowY"},oe={x:"right",y:"bottom"},Pe={x:"width",y:"height"},ut={x:"scrollWidth",y:"scrollHeight"},dt={x:"scrollLeft",y:"scrollTop"},pt=({axis:e,el:t})=>{for(;(t&&=t.parentElement)&&!(t===ze||!ze.contains(t));){if(t[ut[e]]<=t[it[e]])continue;let r=nt(t)[ft[e]];if(r==="scroll"||r==="auto")return t}return P},Ue=({axis:e="y",containerRef:t,growBuffer:r=200,length:o=0,minIndex:s=0,shrinkBuffer:d=r+200})=>{let n=T(()=>({cache:{},columns:1,isRendering:!1,observed:null,observer:null,prev:{cache:{},minIndex:s,start:s},scrollParent:null,scrollTarget:null,syncUpdateCount:0,resolve:()=>{n.scrollTarget=null,n.syncUpdateCount=0}})),c=V(()=>{if(n.isRendering)return;let u=t.current,{end:a,start:f}=i;if(!u||f===a||u.children.length!==a-f)return n.resolve();let{cache:p,prev:l,scrollTarget:g}=n,C=i.start,R=[],x,b=1;for(let w of u.children){let ae=w.getBoundingClientRect(),fe=ae[Pe[e]];p[C++]=fe,R.push(fe);let ue=ae[e];x==null?x=ue:ue===x&&++b}let Ke=R.sort()[Math.floor(R.length/2)];n.columns=b;let M=pt({axis:e,el:u});M!==n.scrollParent&&(n.scrollParent!==P&&n.scrollParent?.removeEventListener("scroll",c),M!==P&&M.addEventListener("scroll",c),n.scrollParent=M);let U=M instanceof Me?ct:M,A=dt[e],J=0,Fe=Math.min(l.minIndex,s),Ve=Math.max(l.start,i.start);for(let w=Fe;w<Ve;w+=b)J+=(p[w]??0)-(l.cache[w]??0);if(J&&(U[A]+=J),n.prev={cache:{...p},minIndex:s,start:i.start},n.syncUpdateCount++>lt)return n.resolve();let Q=u.getBoundingClientRect(),O=Q[e]+i.before,_=Q[oe[e]]-i.after,ce=M instanceof Me?{[e]:0,[oe[e]]:W instanceof st?W[at[e]]:W[Pe[e]]}:M.getBoundingClientRect(),H=ce[e],Z=ce[oe[e]],ee=s+o;for(let w=s;w<ee;++w)p[w]??=Ke;f-=(f-s)%b;let le=(a-s)%b;for(le&&(a+=b-le);f-b>=s&&O>H-r;)O-=p[f-b],f-=b;for(;f<ee&&O+p[f]<=H-d;)O+=p[f],f+=b;for(;a<ee&&_<Z+r;)_+=p[a],a+=b;for(;a-b>=s&&_-p[a-b]>=Z+d;)_-=p[a-b],a-=b;let B=y({end:a,start:f});if(B.after!==i.after||B.before!==i.before||B.end!==i.end||B.start!==i.start)return n.isRendering=!0,m(B);if(!g)return n.resolve();let{index:D}=g;D=Math.min(s+o-1,Math.max(D,s)),D-=(D-s)%b;let ie=0;for(let w=s;w<D;w+=b)ie+=p[w];let X=U[A],We=p[D],$=Q[e]+X-H+ie-g.buffer,I=$-(Z-H)+We+g.buffer*2;g.align==="nearest"&&($<I?g.align="center":X>$?g.align="start":X<I&&(g.align="end")),g.align==="start"?U[A]=$:g.align==="end"?U[A]=I:g.align==="center"&&(U[A]=($+I)/2),U[A]===X?n.resolve():c()}),v=V(({align:u="nearest",buffer:a=0,index:f})=>{n.scrollTarget={align:u,buffer:a,index:f},c()}),y=({end:u,start:a})=>{if(r===1/0)return{after:0,before:0,end:s+o,scrollTo:v,start:s};let{cache:f,columns:p}=n,l=s+o;a-=(a-s)%p,a=Math.min(l,Math.max(a,s));let g=(u-s)%p;g&&(u+=p-g),u=Math.min(l,Math.max(u,a)),u-a<=p&&(u<l?u=Math.min(l,u+p):a>s&&(a-=p));let C=0,R=0;for(let x=s;x<l;x+=p)x<a?C+=f[x]??0:x>=u&&(R+=f[x]??0);return{after:R,before:C,end:u,scrollTo:v,start:a}},[i,m]=L({after:0,before:0,end:0,scrollTo:v,start:0});return T(()=>{Object.assign(i,y({end:i.end,start:i.start}))},[o,s]),n.observer??=Te&&new Te(c),z(()=>{let{observed:u,observer:a}=n,f=t.current;a&&u!==f&&(u&&a.unobserve(u),f&&a.observe(f),n.observed=f),n.isRendering=!1,c()}),z(()=>{let{observer:u}=n;return W.addEventListener("resize",c),P.addEventListener("scroll",c),()=>{u?.disconnect(),W.removeEventListener("resize",c),P.removeEventListener("scroll",c),n.scrollParent?.removeEventListener("scroll",c)}},[n,c]),i};var{clearTimeout:Ae,clearInterval:ht,document:Be,setTimeout:De,setInterval:mt}=globalThis,k=10,$e=e=>`rgb(${32+e*12%128}, ${32+e*23%128}, ${32+e*56%128})`,gt=({children:e})=>{if(Math.random()<.005)throw new Error("red");return z(()=>{if(Math.random()<.005)throw new Error("blue");return()=>{if(Math.random()<.005)throw new Error("yellow")}}),e},yt=G(()=>S("div",{style:{background:"#fff9",borderRadius:"0.25rem",padding:"1rem"},children:["Portal: ",te(se)]})),bt=G(({x:e,y:t})=>{let r=te(se),o=T(()=>`rgb(${128+(e-t)/k*128}, ${128+(t-e)/k*128}, ${(e+t)/k/2*256})`),s=F(void 0),[d,n]=L("black"),c=V(()=>{n(o),Ae(s.current),s.current=De(()=>n("black"),5e3)}),v=1+Math.floor(Math.random()*10);return h(ve,{catch:y=>{n(y.message),Ae(s.current),s.current=De(()=>n("black"),5e3)},children:S("div",{onpointerdown:c,onpointermove:c,style:{alignItems:"center",backgroundColor:d,borderRadius:"0.25rem",display:"flex",fontSize:"0.75rem",flexDirection:"column",gap:"0.25rem",justifyContent:"center",minWidth:"0",overflow:"hidden",padding:"0.25rem",textAlign:"center",transition:d==="black"?"all 5s":""},children:[h("select",{value:(Math.floor(Math.random()*v)+1).toString(),children:Array.from({length:v},(y,i)=>h("option",{value:(i+1).toString(),children:i+1},i))}),d==="red"?"Fake Render Error":d==="blue"?"Fake After Effect Error":d==="yellow"?"Fake Before Effect Error":h(gt,{children:r}),e===0&&t===0&&!!(r%5)&&h(K,{to:Be.getElementById("portal"),children:h(yt,{})})]})})}),vt=G(({index:e})=>S("div",{style:{borderTop:"10px solid #000",borderRight:"10px solid #000",padding:"1rem",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",backgroundColor:$e(e)},children:["Item ",e+1]},e)),se=we(0),Le=1e4,je=()=>{let[e,t]=L(new Date().getSeconds()),[r,o]=L(Array.from({length:9},(y,i)=>i));z(()=>{let y=mt(()=>{t(new Date().getSeconds()),o(i=>i.toSorted(()=>Math.random()-.5))},1e3);return()=>ht(y)},[]);let s=F(null),{start:d,end:n,before:c,after:v}=Ue({containerRef:s,length:Le});return S(se,{value:e,children:[h("div",{style:{boxSizing:"border-box",cursor:"crosshair",display:"grid",gap:"0.25rem",gridTemplate:`repeat(${k}, 1fr) / repeat(${k}, 1fr)`,height:"100%",padding:"0.25rem"},children:Array.from({length:k*k},(y,i)=>h(bt,{x:i%k,y:Math.floor(i/k)},i))}),h("div",{style:{boxSizing:"border-box",cursor:"crosshair",display:"grid",gap:"0.25rem",gridTemplate:"repeat(3, 1fr) / repeat(3, 1fr)",padding:"0.25rem"},children:r.map(y=>S("div",{style:{background:$e(y),borderRadius:"0.25rem",color:"white",display:"flex",padding:"0.5rem"},children:[S("div",{style:{flex:"1",padding:"0.5rem"},children:["Input ",y+1]}),h("input",{style:{display:"block",padding:"0.5rem",flex:"1",borderRadius:"0.25rem",border:"0"}})]},y))}),S("div",{style:{padding:"1rem"},children:[S("div",{style:{color:"#fff",fontWeight:"bold",marginBottom:"0.5rem"},children:[Le," Items"]}),h("div",{"data-list-container":"true",ref:s,style:{color:"white",paddingTop:`${c}px`,paddingBottom:`${v}px`,display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(min(200px, 50%), 1fr))",borderLeft:"10px solid #000",borderBottom:"10px solid #000"},children:Array.from({length:n-d},(y,i)=>h(vt,{index:d+i},d+i))})]}),h("button",{onclick:()=>ne(S("div",{style:{padding:"1rem",textAlign:"center"},children:[h("div",{style:{color:"white",marginBottom:"1rem"},children:"Unmounted!"}),h("button",{onclick:()=>ne(h(je,{})),children:"Remount"})]})),style:{position:"fixed",bottom:"1rem",right:"1rem"},children:"Unmount"})]})},ne=Re(Be.getElementById("root").attachShadow({mode:"open"}));ne(h(je,{}));})();
