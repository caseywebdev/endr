"use strict";(()=>{var{console:Ve,queueMicrotask:We,Element:Oe}=globalThis,y=(e,t,r)=>({type:e,props:t,key:r}),N=y;var me={},ge={},_e=y(ge,me),ye={},He=[],Xe="moveBefore"in Oe.prototype?"moveBefore":"insertBefore",qe="http://www.w3.org/2000/svg",Ye=e=>Ve.error(e),be=e=>e==null||e===!1||e==="",T=e=>typeof e=="function",Ge=e=>Array.isArray(e),B=e=>typeof e=="object"&&e!==null,ve=e=>e.children,Q=e=>e.children,we=e=>(x.catch=e.catch,e.children),Ee=e=>{let t=({value:r,children:n})=>{let s=x,p=M(()=>{let o={deps:new Set,value:r};return s.contexts=new Map(s.contexts).set(t,o),o});if(r!==p.value){p.value=r;for(let o of p.deps){o.state=1;let{parent:c}=o;for(;c&&c!==s&&!c.state;)c.state=2,{parent:c}=c}}return n};return t.value=e,t},Je=(e,t,r)=>T(e)||e===ge?null:e===ye?r.ownerDocument.createTextNode(t.nodeValue):r.ownerDocument.createElementNS(e==="svg"?qe:"namespaceURI"in r?r.namespaceURI:r.host.namespaceURI,e),Qe=e=>e.nodeType===e.TEXT_NODE,de=(e,t)=>t in e&&(e[t]==null||!B(e[t])),he=(e,t,r)=>{if(Qe(e)){e.nodeValue=r.nodeValue;return}for(let n in t)n==="children"||n in r||(n==="ref"?t.ref&&(t.ref.current=null):de(e,n)?e[n]="":e.removeAttribute(n));for(let n in r)if(!(n==="children"||t[n]===r[n]))if(n==="ref")t.ref&&(t.ref.current=null),r.ref&&(r.ref.current=e);else if(n==="style"&&B(r[n])){let{style:s}=e,p=B(t[n])?t[n]:{},o=r[n];for(let c in p)c in o||(s[c]="");for(let c in o)s[c]=o[c]??""}else de(e,n)?e[n]=r[n]??"":r[n]!=null?e.setAttribute(n,r[n]):e.removeAttribute(n)},x=null,q=0,Y=0,$=e=>{let t=x;t.refs??=[];let r=t.refs[Y++];return r||(r={current:T(e)?e():e},t.refs.push(r)),r},P=(e,t)=>{let r=x;r.effects??=[];let n=r.effects[q++];n?(!n.deps||!t||Se(n.deps,t))&&(n.after=e,n.deps=t):r.effects.push({before:void 0,after:e,deps:t})},M=(e,t=He)=>{let r=$(()=>({value:e(),deps:t}));return Se(r.current.deps,t)&&(r.current.value=e(),r.current.deps=t),r.current.value},K=e=>{let t=x,r=M(()=>[T(e)?e():e,n=>{let s=T(n)?n(r[0]):n;return s!==r[0]&&(r[0]=s,et(t)),s}]);return[...r]},Se=(e,t)=>{if(e===t)return!1;let{length:r}=e;if(r!==t.length)return!0;for(;r--;)if(e[r]!==t[r])return!0;return!1},F=e=>{let t=$(()=>e);return t.current=e,M(()=>(...r)=>t.current(...r))},Ze=(e,t)=>{if(e===t)return!0;for(let r in e)if(e[r]!==t[r])return!1;for(let r in t)if(!(r in e))return!1;return!0},Z=(e,t=Ze)=>(e.memo=t,e),oe=e=>{let t=x,r=t.contexts?.get(e);return P(()=>{if(r)return r.deps.add(t),()=>r.deps.delete(t)},[r,t]),(r??e).value},Ie=(e,t)=>{for(;e.depth>t.depth;)if(e=e.parent,e===t)return 1;for(;t.depth>e.depth;)if(t=t.parent,t===e)return-1;for(;e.parent!==t.parent;)e=e.parent,t=t.parent;return e.index-t.index},et=e=>{if(e.state===1||e.state===3)return;let{queues:t}=e,{updates:r}=t;r.length===0&&We(()=>{let n=r.sort(Ie);t.updates=[];for(let s=0;s<n.length;++s){let p=n[s];p.state===1&&J(p)}G(t)}),r.push(e),e.state=1},tt=e=>{let{children:t}=e.props;if(T(e.type)){let r=[x,q,Y];x=e,q=0,Y=0;try{t=e.type(e.props)}catch(n){t=null,e.catch(n)}finally{[x,q,Y]=r}}return be(t)?[]:Ge(t)?t:[t]},rt=e=>be(e)?_e:Array.isArray(e)?y(ve,{children:e}):B(e)&&Object.keys(e).length===3&&(typeof e.type=="string"||T(e.type))&&B(e.props)&&"key"in e?e:y(ye,{nodeValue:e}),xe=e=>{let{child:t,state:r}=e;if(r===1)J(e);else if(r===2)for(e.state=0;t;t=t.sibling)xe(t)},Ce=({child:e,node:t})=>{if(t)return[t];let r=[];for(;e;e=e.sibling)r.push(...Ce(e));return r},J=e=>{let{depth:t,queues:r}=e,{afterEffects:n,inserts:s,moves:p,nodeUpdates:o}=r,c=e.child,a=c&&new Map;for(;c;c=c.sibling)a.set(c.key??c.index,c);let m=e.node??e.parentNode,u=tt(e);if(e.effects)try{for(let i=0;i<e.effects.length;++i){let f=e.effects[i];f.after&&f.before&&(f.before(),f.before=void 0)}}catch(i){e.catch(i)}e.state=0,e.child=null;let S=e.node?null:e.prevNode;for(let i=0,f=null;i<u.length;++i){let{type:h,props:d,key:v}=rt(u[i]),l=a?.get(v??i),R=!1,E=null,w=!1;if(l?.type===h)a.delete(v??i),l.index=i,l.sibling=null,(!T(l.type)||!l.type.memo?.(l.props,d))&&(l.node&&(E=[l.node,l.props,d]),l.props=d,l.state=1),l.parentNode===m&&l.lastNode&&S!==l.prevNode&&(R=!0);else{try{l={catch:e.catch,child:null,contexts:e.contexts,depth:t+1,effects:null,index:i,key:v,lastNode:null,node:Je(h,d,m),parent:e,props:d,queues:r,refs:null,sibling:null,state:1,type:h,...h===Q?{parentNode:d.to,prevNode:d.to.lastChild}:{parentNode:m,prevNode:S}}}catch(g){e.catch(g);continue}l.node&&(w=!0)}l.parentNode===m&&(l.prevNode=S),f?f.sibling=l:e.child=l,xe(l),R&&p.push(l),E&&o.push(E),w&&s.push(l),l.parentNode===m&&l.lastNode&&(S=l.lastNode),f=l}if(e.lastNode=e.node??S??null,a)for(let i of a.values())ne(i);e.effects&&n.push(e)},ne=(e,t=!0)=>{e.state=3;let{effects:r,child:n,props:s,node:p}=e;if(r)try{for(let c=0;c<r.length;++c){let a=r[c];a.before&&(a.before(),a.before=void 0)}}catch(c){e.catch(c)}let o=t&&!p;for(;n;n=n.sibling)ne(n,o||n.type===Q);p&&(s.ref&&(s.ref.current=null),t&&e.queues.removes.unshift(p))},G=e=>{let{afterEffects:t,inserts:r,moves:n,nodeUpdates:s,removes:p}=e;for(let o=p.length-1;o>=0;--o)p[o].remove();e.removes=[];for(let o=0;o<n.length;++o){let c=n[o],{parentNode:a,prevNode:m}=c,u=m?m.nextSibling:a.firstChild;for(let S of Ce(c))a[Xe](S,u)}e.moves=[];for(let o=0;o<r.length;++o){let{node:c,parentNode:a,prevNode:m,props:u}=r[o];he(c,me,u),a.insertBefore(c,m?m.nextSibling:a.firstChild)}e.inserts=[];for(let o=0;o<s.length;++o)he(...s[o]);e.nodeUpdates=[];for(let o=0;o<t.length;++o){let c=t[o],a=c.effects;try{for(let m=0;m<a.length;++m){let u=a[m];u.after&&(u.before=u.after(),u.after=void 0)}}catch(m){c.catch(m)}}e.afterEffects=[]},ke=e=>{let t={afterEffects:[],inserts:[],moves:[],nodeUpdates:[],removes:[],updates:[]},r={catch:Ye,child:null,contexts:null,depth:0,effects:null,index:0,key:void 0,lastNode:null,node:null,parent:null,parentNode:e,prevNode:e.lastChild,props:{},queues:t,refs:null,sibling:null,state:1,type:ve};return J(r),G(t),{render:n=>{r.props={children:n},J(r),G(t)},unmount:()=>{ne(r),G(t)}}};var{document:z,getComputedStyle:ot,Document:Me,ResizeObserver:Re,window:Te,Window:nt}=globalThis,{body:Ne}=z,st=z.scrollingElement,V=Te.visualViewport??Te,ct=10,lt={x:"clientWidth",y:"clientHeight"},it={x:"innerWidth",y:"innerHeight"},ft={x:"overflowX",y:"overflowY"},se={x:"right",y:"bottom"},Pe={x:"width",y:"height"},at={x:"scrollWidth",y:"scrollHeight"},ut={x:"scrollLeft",y:"scrollTop"},pt=({axis:e,el:t})=>{for(;(t&&=t.parentElement)&&!(t===Ne||!Ne.contains(t));){if(t[at[e]]<=t[lt[e]])continue;let r=ot(t)[ft[e]];if(r==="scroll"||r==="auto")return t}return z},ze=({axis:e="y",containerRef:t,growBuffer:r=200,length:n=0,minIndex:s=0,shrinkBuffer:p=r+200})=>{let o=M(()=>({cache:{},columns:1,isRendering:!1,observed:null,observer:null,prev:{cache:{},minIndex:s,start:s},scrollParent:null,scrollTarget:null,syncUpdateCount:0,resolve:()=>{o.scrollTarget=null,o.syncUpdateCount=0}})),c=F(()=>{if(o.isRendering)return;let i=t.current,{end:f,start:h}=u;if(!i||h===f||i.children.length!==f-h)return o.resolve();let{cache:d,prev:v,scrollTarget:l}=o,R=u.start,E=[],w,g=1;for(let b of i.children){let ae=b.getBoundingClientRect(),ue=ae[Pe[e]];d[R++]=ue,E.push(ue);let pe=ae[e];w==null?w=pe:pe===w&&++g}let Be=E.sort()[Math.floor(E.length/2)];o.columns=g;let k=pt({axis:e,el:i});k!==o.scrollParent&&(o.scrollParent!==z&&o.scrollParent?.removeEventListener("scroll",c),k!==z&&k.addEventListener("scroll",c),o.scrollParent=k);let U=k instanceof Me?st:k,A=ut[e],I=0,$e=Math.min(v.minIndex,s),Ke=Math.max(v.start,u.start);for(let b=$e;b<Ke;b+=g)I+=(d[b]??0)-(v.cache[b]??0);if(I&&(U[A]+=I),o.prev={cache:{...d},minIndex:s,start:u.start},o.syncUpdateCount++>ct)return o.resolve();let ee=i.getBoundingClientRect(),W=ee[e]+u.before,O=ee[se[e]]-u.after,le=k instanceof Me?{[e]:0,[se[e]]:V instanceof nt?V[it[e]]:V[Pe[e]]}:k.getBoundingClientRect(),_=le[e],te=le[se[e]],re=s+n;for(let b=s;b<re;++b)d[b]??=Be;h-=(h-s)%g;let ie=(f-s)%g;for(ie&&(f+=g-ie);h-g>=s&&W>_-r;)W-=d[h-g],h-=g;for(;h<re&&W+d[h]<=_-p;)W+=d[h],h+=g;for(;f<re&&O<te+r;)O+=d[f],f+=g;for(;f-g>=s&&O-d[f-g]>=te+p;)O-=d[f-g],f-=g;let L=m({end:f,start:h});if(L.after!==u.after||L.before!==u.before||L.end!==u.end||L.start!==u.start)return o.isRendering=!0,S(L);if(!l)return o.resolve();let{index:D}=l;D=Math.min(s+n-1,Math.max(D,s)),D-=(D-s)%g;let fe=0;for(let b=s;b<D;b+=g)fe+=d[b];let H=U[A],Fe=d[D],j=ee[e]+H-_+fe-l.buffer,X=j-(te-_)+Fe+l.buffer*2;l.align==="nearest"&&(j<X?l.align="center":H>j?l.align="start":H<X&&(l.align="end")),l.align==="start"?U[A]=j:l.align==="end"?U[A]=X:l.align==="center"&&(U[A]=(j+X)/2),U[A]===H?o.resolve():c()}),a=F(({align:i="nearest",buffer:f=0,index:h})=>{o.scrollTarget={align:i,buffer:f,index:h},c()}),m=({end:i,start:f})=>{if(r===1/0)return{after:0,before:0,end:s+n,scrollTo:a,start:s};let{cache:h,columns:d}=o,v=s+n;f-=(f-s)%d,f=Math.min(v,Math.max(f,s));let l=(i-s)%d;l&&(i+=d-l),i=Math.min(v,Math.max(i,f)),i-f<=d&&(i<v?i=Math.min(v,i+d):f>s&&(f-=d));let R=0,E=0;for(let w=s;w<v;w+=d)w<f?R+=h[w]??0:w>=i&&(E+=h[w]??0);return{after:E,before:R,end:i,scrollTo:a,start:f}},[u,S]=K({after:0,before:0,end:0,scrollTo:a,start:0});return M(()=>{Object.assign(u,m({end:u.end,start:u.start}))},[n,s]),o.observer??=Re&&new Re(c),P(()=>{let{observed:i,observer:f}=o,h=t.current;f&&i!==h&&(i&&f.unobserve(i),h&&f.observe(h),o.observed=h),o.isRendering=!1,c()}),P(()=>{let{observer:i}=o;return V.addEventListener("resize",c),z.addEventListener("scroll",c),()=>{i?.disconnect(),V.removeEventListener("resize",c),z.removeEventListener("scroll",c),o.scrollParent?.removeEventListener("scroll",c)}},[o,c]),u};var{clearTimeout:Ue,document:Le,setTimeout:Ae,setInterval:dt}=globalThis,C=10,ht=({children:e})=>{if(Math.random()<.005)throw new Error("red");return P(()=>{if(Math.random()<.005)throw new Error("blue");return()=>{if(Math.random()<.005)throw new Error("yellow")}}),e},mt=Z(()=>N("div",{style:{background:"#fff9",borderRadius:"0.25rem",padding:"1rem"},children:["Portal: ",oe(ce)]})),gt=Z(({x:e,y:t})=>{let r=oe(ce),n=M(()=>`rgb(${128+(e-t)/C*128}, ${128+(t-e)/C*128}, ${(e+t)/C/2*256})`),s=$(void 0),[p,o]=K("black"),c=F(()=>{o(n),Ue(s.current),s.current=Ae(()=>o("black"),5e3)}),a=1+Math.floor(Math.random()*10);return y(we,{catch:m=>{o(m.message),Ue(s.current),s.current=Ae(()=>o("black"),5e3)},children:N("div",{onpointerdown:c,onpointermove:c,style:{alignItems:"center",backgroundColor:p,borderRadius:"0.25rem",display:"flex",fontSize:"0.75rem",flexDirection:"column",gap:"0.25rem",justifyContent:"center",minWidth:"0",overflow:"hidden",padding:"0.25rem",textAlign:"center",transition:p==="black"?"all 5s":""},children:[y("select",{value:(Math.floor(Math.random()*a)+1).toString(),children:Array.from({length:a},(m,u)=>y("option",{value:(u+1).toString(),children:u+1},u))}),p==="red"?"Fake Render Error":p==="blue"?"Fake After Effect Error":p==="yellow"?"Fake Before Effect Error":y(ht,{children:r}),e===0&&t===0&&!!(r%5)&&y(Q,{to:Le.getElementById("portal"),children:y(mt,{})})]})})}),yt=Z(({index:e})=>N("div",{style:{borderTop:"10px solid #000",borderRight:"10px solid #000",padding:"1rem",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",backgroundColor:`rgb(${e*13%128}, ${e*19%128}, ${e*23%128})`},children:["Item ",e+1]},e)),ce=Ee(0),De=1e4,bt=()=>{let[e,t]=K(new Date().getSeconds());P(()=>{dt(()=>t(new Date().getSeconds()),1e3)},[]);let r=$(null),{start:n,end:s,before:p,after:o}=ze({containerRef:r,length:De});return N(ce,{value:e,children:[y("div",{style:{boxSizing:"border-box",cursor:"crosshair",display:"grid",gap:"0.25rem",gridTemplate:`repeat(${C}, 1fr) / repeat(${C}, 1fr)`,height:"100%",padding:"0.25rem"},children:Array.from({length:C*C},(c,a)=>y(gt,{x:a%C,y:Math.floor(a/C)},a))}),N("div",{style:{padding:"1rem"},children:[N("div",{style:{color:"#fff",fontWeight:"bold",marginBottom:"0.5rem"},children:[De," Items"]}),y("div",{"data-list-container":"true",ref:r,style:{color:"white",paddingTop:`${p}px`,paddingBottom:`${o}px`,display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(min(200px, 50%), 1fr))",borderLeft:"10px solid #000",borderBottom:"10px solid #000"},children:Array.from({length:s-n},(c,a)=>y(yt,{index:n+a},n+a))})]}),y("button",{onclick:je.unmount,style:{position:"fixed",bottom:"1rem",right:"1rem"},children:"Unmount"})]})},je=ke(Le.getElementById("root").attachShadow({mode:"open"}));je.render(y(bt,{}));})();
