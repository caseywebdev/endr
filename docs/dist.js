"use strict";(()=>{var{console:oe,document:$,queueMicrotask:se,Text:ce}=globalThis,p=(e,t=G,r)=>({type:e,props:t,key:r}),T=p;var B=e=>e.children,z=e=>(a.catch=e.catch,e.children),O=()=>{let e=({value:t,children:r})=>{let n=a,l=g(()=>{let f={deps:new Set,value:t};return n.contexts=new Map(n.contexts).set(e,f),f});if(t!==l.value){l.value=t;for(let f of l.deps){if(f.queues!==n.queues){X(f);continue}f.state=1;let{parent:o}=f;for(;o&&o!==n&&!o.state;)o.state=2,{parent:o}=o}}return r};return e},_=e=>e==null||e===!1||e==="",G={},H={},le={type:H,props:G,key:void 0},J={},fe=[],ie="http://www.w3.org/2000/svg",ue=e=>oe.error(e),ae=(e,t,r)=>{if(typeof e=="function"||e===H)return null;if(e===J)return $.createTextNode(t.nodeValue);let n=$.createElementNS(e==="svg"?ie:r.namespaceURI,e);return K(n,{},t),n},q=(e,t)=>t in e&&(e[t]==null||typeof e[t]!="object"),pe=(e,t,r)=>{for(let n in t)n in r||(e[n]="");for(let n in r)e[n]=r[n]??""},K=(e,t,r)=>{if(e instanceof ce){e.nodeValue=r.nodeValue;return}for(let n in t)n==="children"||n in r||(n==="ref"?t.ref&&(t.ref.current=null):q(e,n)?e[n]="":e.removeAttribute(n));for(let n in r)n==="children"||t[n]===r[n]||(n==="ref"?(t.ref&&(t.ref.current=null),r.ref&&(r.ref.current=e)):n==="style"&&r[n]&&typeof r[n]=="object"?pe(e.style,t[n]&&typeof t[n]=="object"?t[n]:{},r[n]):q(e,n)?e[n]=r[n]??"":r[n]!=null?e.setAttribute(n,r[n]):e.removeAttribute(n))},a=null,k=0,w=0,A=e=>{let t=a;t.refs??=[];let r=t.refs[w++];return r||(r={current:e},t.refs.push(r)),r},N=(e,t)=>{let r=a;r.effects??=[];let n=r.effects[k++];n?(!n.deps||!t||L(n.deps,t))&&(n.after=e,n.deps=t):r.effects.push({before:void 0,after:e,deps:t})},g=(e,t=fe)=>{let r=A(null);return r.current?L(r.current.deps,t)&&(r.current.value=e(),r.current.deps=t):r.current={value:e(),deps:t},r.current.value},D=e=>{let t=a,r=g(()=>[e,n=>{let l=typeof n=="function"?n(r[0]):n;return l===r[0]||(r[0]=l,X(t)),l}]);return r},L=(e,t)=>{let{length:r}=e;if(r!==t.length)return!0;for(;r--;)if(e[r]!==t[r])return!0;return!1};var de=(e,t)=>{if(e===t)return!0;for(let r in e)if(e[r]!==t[r])return!1;for(let r in t)if(!(r in e))return!1;return!0},Q=(e,t=de)=>(e.memo=t,e),R=e=>{let t=a,r=t.contexts?.get(e);return N(()=>{if(r)return r.deps.add(t),()=>r.deps.delete(t)},[r,t]),r?.value},W=()=>{let{contexts:e}=a;return g(()=>({children:t})=>(a.contexts=e,t))},he=(e,t)=>{for(;e.depth>t.depth;)if(e=e.parent,e===t)return 1;for(;t.depth>e.depth;)if(t=t.parent,t===e)return-1;for(;e.parent!==t.parent;)e=e.parent,t=t.parent;return e.index-t.index},X=e=>{if(e.state===1||e.state===3)return;let{queues:t}=e,{updates:r}=t;r.length===0&&se(()=>{let n=r.sort(he);t.updates=[];for(let l=0;l<n.length;++l){let f=n[l];f.state===1&&E(f)}C(t)}),r.push(e),e.state=1},ye=e=>{let{children:t}=e.props;if(typeof e.type=="function"){let r=[a,k,w];a=e,k=0,w=0;try{t=e.type(e.props)}catch(n){t=null,e.catch(n)}[a,k,w]=r}return _(t)?[]:Array.isArray(t)?t:[t]},me=e=>_(e)?le:Array.isArray(e)?{type:B,props:{children:e},key:void 0}:e&&typeof e=="object"&&Object.keys(e).length===3&&"type"in e&&(typeof e.type=="string"||typeof e.type=="function")&&"props"in e&&e.props&&typeof e.props=="object"&&"key"in e?e:{type:J,props:{nodeValue:e},key:void 0},Y=e=>{let{child:t,state:r}=e;if(r===1)E(e);else if(r===2)for(e.state=0;t;t=t.sibling)Y(t)},P=({child:e,node:t})=>{if(t)return[t];let r=[];for(;e;e=e.sibling)r.push(...P(e));return r},E=e=>{let{depth:t,queues:r}=e,{afterEffects:n,inserts:l,moves:f,nodeUpdates:o}=r;if(e.effects)try{for(let i=0;i<e.effects.length;++i){let y=e.effects[i];y.after&&y.before&&(y.before(),y.before=void 0)}}catch(i){e.catch(i)}let s=e.child,h=s&&new Map;for(;s;s=s.sibling)h.set(s.key??s.index,s);let u=e.node??e.parentNode,m=ye(e);e.state=0,e.child=null;let x=e.node?null:e.prevNode;for(let i=0,y=null;i<m.length;++i){let{type:j,props:b,key:M}=me(m[i]),c=h?.get(M??i),V=!1,v=null,F=!1;if(c?.type===j)h.delete(M??i),c.index=i,c.sibling=null,(typeof c.type!="function"||!c.type.memo?.(c.props,b))&&(c.node&&(v=[c.node,c.props,b]),c.props=b,c.state=1),c.parentNode===u&&c.lastNode&&x!==c.prevNode&&(V=!0);else{try{c={catch:e.catch,child:null,contexts:e.contexts,depth:t+1,effects:null,index:i,key:M,lastNode:null,node:ae(j,b,u),parent:e,parentNode:u,prevNode:null,props:b,queues:r,refs:null,sibling:null,state:1,type:j}}catch(ne){e.catch(ne);continue}c.node&&(F=!0)}c.parentNode===u&&(c.prevNode=x),y?y.sibling=c:e.child=c,Y(c),V&&f.push(c),v&&o.push(v),F&&l.push(c),c.parentNode===u&&c.lastNode&&(x=c.lastNode),y=c}if(e.lastNode=e.node??x??null,h)for(let i of h.values())I(i);e.effects&&n.push(e)},I=(e,t=!0)=>{e.state=3;let{effects:r,child:n,node:l}=e;if(r)try{for(let o=0;o<r.length;++o){let s=r[o];s.before&&(s.before(),s.before=void 0)}}catch(o){e.catch(o)}let f=t&&!l;for(;n;n=n.sibling)I(n,f);t&&l&&e.queues.removes.unshift(l)},C=e=>{let{afterEffects:t,inserts:r,moves:n,nodeUpdates:l,removes:f}=e;for(let o=f.length-1;o>=0;--o)f[o].remove();e.removes=[];for(let o=0;o<n.length;++o){let s=n[o];s.prevNode?s.prevNode.after(...P(s)):s.parentNode.prepend(...P(s))}e.moves=[];for(let o=0;o<l.length;++o)K(...l[o]);e.nodeUpdates=[];for(let o=0;o<r.length;++o){let s=r[o];s.prevNode?s.prevNode.after(s.node):s.parentNode.prepend(s.node)}e.inserts=[];for(let o=0;o<t.length;++o){let s=t[o],h=s.effects;try{for(let u=0;u<h.length;++u){let m=h[u];m.after&&(m.before=m.after(),m.after=void 0)}}catch(u){s.catch(u)}}e.afterEffects=[]},S=e=>{let t={afterEffects:[],inserts:[],moves:[],nodeUpdates:[],removes:[],updates:[]},r={catch:ue,child:null,contexts:null,depth:0,effects:null,index:0,key:void 0,lastNode:null,node:null,parent:null,parentNode:e,prevNode:e.lastChild,props:{},queues:t,refs:null,sibling:null,state:1,type:B};return E(r),C(t),{render:n=>{r.props={children:n},E(r),C(t)},unmount:()=>{I(r),C(t)}}};var{clearTimeout:Z,document:te,setTimeout:ee,setInterval:ge}=globalThis,d=10,be=({children:e})=>{if(Math.random()<.01)throw new Error("red");return N(()=>{if(Math.random()<.01)throw new Error("blue");return()=>{if(Math.random()<.01)throw new Error("yellow")}}),e},Ne=()=>T("div",{style:{background:"#fff9",borderRadius:"0.25rem",padding:"1rem"},children:["Portal: ",R(U)]}),xe=({children:e,to:t})=>{let r=W(),n=g(()=>S(t),[t]);N(()=>n.unmount,[n]),n.render(p(r,{children:e}))},ke=Q(({x:e,y:t})=>{let r=R(U)??0,n=g(()=>`rgb(${128+(e-t)/d*128}, ${128+(t-e)/d*128}, ${(e+t)/d/2*256})`),l=A(void 0),[f,o]=D("black");return p(z,{catch:s=>{o(s.message),Z(l.current),l.current=ee(()=>o("black"),5e3)},children:T("div",{onpointermove:()=>{o(n),Z(l.current),l.current=ee(()=>o("black"),5e3)},ontouchmove:s=>s.preventDefault(),style:{backgroundColor:f,transition:f==="black"?"all 5s":"",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden"},children:[f==="red"?"Fake Render Error":f==="blue"?"Fake After Effect Error":f==="yellow"?"Fake Before Effect Error":p(be,{children:r}),e===0&&t===0&&!!(r%5)&&p(xe,{to:te.getElementById("portal"),children:p(Ne,{})})]})})}),U=O(),we=()=>{let[e,t]=D(new Date().getSeconds());return N(()=>{ge(()=>t(new Date().getSeconds()),1e3)},[]),T(U,{value:e,children:[p("div",{style:{cursor:"crosshair",display:"grid",gridTemplate:`repeat(${d}, 1fr) / repeat(${d}, 1fr)`,height:"100%"},children:Array.from({length:d*d},(r,n)=>p(ke,{x:n%d,y:Math.floor(n/d)},n))}),p("button",{onclick:re.unmount,style:{position:"fixed",bottom:"1rem",right:"1rem"},children:"Unmount"})]})},re=S(te.getElementById("root"));re.render(p(we,{}));})();
