"use strict";(()=>{var{console:We,queueMicrotask:Oe,Element:_e}=globalThis,y=(e,t,r)=>({type:e,props:t,key:r}),E=y;var me={},ge={},He=y(ge,me),ye={},qe=[],Xe="moveBefore"in _e.prototype?"moveBefore":"insertBefore",Ie="http://www.w3.org/2000/svg",Ye=e=>We.error(e),be=e=>e==null||e===!1||e==="",N=e=>typeof e=="function",Ge=e=>Array.isArray(e),$=e=>typeof e=="object"&&e!==null,ve=e=>e.children,K=e=>e.children,we=e=>(S.catch=e.catch,e.children),xe=e=>{let t=({value:r,children:o})=>{let s=S,c=T(()=>{let n={deps:new Set,value:r};return s.contexts=new Map(s.contexts).set(t,n),n});if(r!==c.value){c.value=r;for(let n of c.deps){n.state=1;let{parent:l}=n;for(;l&&l!==s&&!l.state;)l.state=2,{parent:l}=l}}return o};return t.value=e,t},Je=(e,t,r)=>N(e)||e===ge?null:e===ye?r.ownerDocument.createTextNode(t.nodeValue):r.ownerDocument.createElementNS(e==="svg"?Ie:"namespaceURI"in r?r.namespaceURI:r.host.namespaceURI,e),Qe=e=>e.nodeType===e.TEXT_NODE,pe=(e,t)=>t in e&&(e[t]==null||!$(e[t])),he=(e,t,r)=>{if(Qe(e)){e.nodeValue=r.nodeValue;return}for(let o in t)o==="children"||o in r||(o==="ref"?t.ref&&(t.ref.current=null):pe(e,o)?e[o]="":e.removeAttribute(o));for(let o in r)if(!(o==="children"||t[o]===r[o]))if(o==="ref")t.ref&&(t.ref.current=null),r.ref&&(r.ref.current=e);else if(o==="style"&&$(r[o])){let{style:s}=e,c=$(t[o])?t[o]:{},n=r[o];for(let l in c)l in n||(s[l]="");for(let l in n)s[l]=n[l]??""}else pe(e,o)?e[o]=r[o]??"":r[o]!=null?e.setAttribute(o,r[o]):e.removeAttribute(o)},S=null,I=0,Y=0,F=e=>{let t=S;t.refs??=[];let r=t.refs[Y++];return r||(r={current:N(e)?e():e},t.refs.push(r)),r},z=(e,t)=>{let r=S;r.effects??=[];let o=r.effects[I++];o?(!o.deps||!t||Se(o.deps,t))&&(o.after=e,o.deps=t):r.effects.push({before:void 0,after:e,deps:t})},T=(e,t=qe)=>{let r=F(()=>({value:e(),deps:t}));return Se(r.current.deps,t)&&(r.current.value=e(),r.current.deps=t),r.current.value},L=e=>{let t=S,r=T(()=>[N(e)?e():e,o=>{let s=N(o)?o(r[0]):o;return s!==r[0]&&(r[0]=s,tt(t)),s}]);return[...r]},Se=(e,t)=>{if(e===t)return!1;let{length:r}=e;if(r!==t.length)return!0;for(;r--;)if(e[r]!==t[r])return!0;return!1},V=e=>{let t=F(()=>e);return t.current=e,T(()=>(...r)=>t.current(...r))},Ze=(e,t)=>{if(e===t)return!0;for(let r in e)if(e[r]!==t[r])return!1;for(let r in t)if(!(r in e))return!1;return!0},Q=(e,t=Ze)=>(e.memo=t,e),oe=e=>{let t=S,r=t.contexts?.get(e);return z(()=>{if(r)return r.deps.add(t),()=>r.deps.delete(t)},[r,t]),(r??e).value},et=(e,t)=>{for(;e.depth>t.depth;)if(e=e.parent,e===t)return 1;for(;t.depth>e.depth;)if(t=t.parent,t===e)return-1;for(;e.parent!==t.parent;)e=e.parent,t=t.parent;return e.index-t.index},tt=e=>{if(e.state===1||e.state===3)return;let{queues:t}=e,{updates:r}=t;r.length===0&&Oe(()=>{let o=r.sort(et);t.updates=[];for(let s=0;s<o.length;++s){let c=o[s];c.state===1&&J(c)}G(t)}),r.push(e),e.state=1},rt=e=>{let{children:t}=e.props;if(N(e.type)){let r=[S,I,Y];S=e,I=0,Y=0;try{t=e.type(e.props)}catch(o){t=null,e.catch(o)}finally{[S,I,Y]=r}}return be(t)?[]:Ge(t)?t:[t]},ot=e=>be(e)?He:Array.isArray(e)?y(ve,{children:e}):$(e)&&Object.keys(e).length===3&&(typeof e.type=="string"||N(e.type))&&$(e.props)&&"key"in e?e:y(ye,{nodeValue:e}),Ee=e=>{let{child:t,state:r}=e;if(r===1)J(e);else if(r===2)for(e.state=0;t;t=t.sibling)Ee(t)},ke=({child:e,node:t})=>{if(t)return[t];let r=[];for(;e;e=e.sibling)r.push(...ke(e));return r},J=e=>{let{depth:t,queues:r}=e,{afterEffects:o,inserts:s,nodeUpdates:c}=r,n=e.child,l=n&&new Map;for(;n;n=n.sibling)l.set(n.key??n.index,n);let p=e.node??e.parentNode,h=rt(e);if(e.effects)try{for(let g=0;g<e.effects.length;++g){let f=e.effects[g];f.after&&f.before&&(f.before(),f.before=void 0)}}catch(g){e.catch(g)}e.state=0,e.child=null;let a=e.node?null:e.prevNode;for(let g=0,f=null;g<h.length;++g){let{type:i,props:d,key:m}=ot(h[g]),u=l?.get(m??g),b=null,C=!1;if(u?.type===i)l.delete(m??g),u.index=g,u.sibling=null,(!N(u.type)||!u.type.memo?.(u.props,d))&&(u.node&&(b=[u.node,u.props,d]),u.props=d,u.state=1),u.parentNode===p&&u.lastNode&&u.prevNode!==a&&(C=!0);else{try{u={catch:e.catch,child:null,contexts:e.contexts,depth:t+1,effects:null,index:g,key:m,lastNode:null,node:Je(i,d,p),parent:e,parentNode:i===K?d.to:p,prevNode:i===K?d.to.lastChild:a,props:d,queues:r,refs:null,sibling:null,state:1,type:i}}catch(R){e.catch(R);continue}u.node&&(C=!0)}u.parentNode===p&&(u.prevNode=a),f?f.sibling=u:e.child=u,Ee(u),b&&c.push(b),C&&s.push(u),u.parentNode===p&&u.lastNode&&(a=u.lastNode),f=u}if(e.lastNode=e.node??a??null,l)for(let g of l.values())ne(g);e.effects&&o.push(e)},ne=(e,t=!0)=>{e.state=3;let{effects:r,child:o,props:s,node:c}=e;if(r)try{for(let l=0;l<r.length;++l){let p=r[l];p.before&&(p.before(),p.before=void 0)}}catch(l){e.catch(l)}let n=t&&!c;for(;o;o=o.sibling)ne(o,n||o.type===K);c&&(s.ref&&(s.ref.current=null),t&&e.queues.removes.unshift(c))},G=e=>{let{afterEffects:t,inserts:r,nodeUpdates:o,removes:s}=e;for(let c=s.length-1;c>=0;--c)s[c].remove();e.removes=[];for(let c=0;c<r.length;++c){let n=r[c],{node:l,parentNode:p,prevNode:h,props:a}=n,g=h?h.nextSibling:p.firstChild;if(l&&!l.parentNode)he(l,me,a),p.insertBefore(l,g);else{let f=ke(n);for(let i=0;i<f.length;++i){let d=f[i];if(d===g||d.nextSibling===g)break;p[Xe](d,g)}}}e.inserts=[];for(let c=0;c<o.length;++c)he(...o[c]);e.nodeUpdates=[];for(let c=0;c<t.length;++c){let n=t[c],l=n.effects;try{for(let p=0;p<l.length;++p){let h=l[p];h.after&&(h.before=h.after(),h.after=void 0)}}catch(p){n.catch(p)}}e.afterEffects=[]},Ce=e=>{let t={afterEffects:[],inserts:[],nodeUpdates:[],removes:[],updates:[]},r={catch:Ye,child:null,contexts:null,depth:0,effects:null,index:0,key:void 0,lastNode:null,node:null,parent:null,parentNode:e,prevNode:e.lastChild,props:{},queues:t,refs:null,sibling:null,state:1,type:ve};return J(r),G(t),{render:o=>{r.props={children:o},J(r),G(t)},unmount:()=>{ne(r),G(t)}}};var{document:P,getComputedStyle:nt,Document:Re,ResizeObserver:Me,window:Te,Window:st}=globalThis,{body:Ne}=P,lt=P.scrollingElement,W=Te.visualViewport??Te,ct=10,it={x:"clientWidth",y:"clientHeight"},at={x:"innerWidth",y:"innerHeight"},ft={x:"overflowX",y:"overflowY"},se={x:"right",y:"bottom"},ze={x:"width",y:"height"},ut={x:"scrollWidth",y:"scrollHeight"},dt={x:"scrollLeft",y:"scrollTop"},pt=({axis:e,el:t})=>{for(;(t&&=t.parentElement)&&!(t===Ne||!Ne.contains(t));){if(t[ut[e]]<=t[it[e]])continue;let r=nt(t)[ft[e]];if(r==="scroll"||r==="auto")return t}return P},Pe=({axis:e="y",containerRef:t,growBuffer:r=200,length:o=0,minIndex:s=0,shrinkBuffer:c=r+200})=>{let n=T(()=>({cache:{},columns:1,isRendering:!1,observed:null,observer:null,prev:{cache:{},minIndex:s,start:s},scrollParent:null,scrollTarget:null,syncUpdateCount:0,resolve:()=>{n.scrollTarget=null,n.syncUpdateCount=0}})),l=V(()=>{if(n.isRendering)return;let f=t.current,{end:i,start:d}=a;if(!f||d===i||f.children.length!==i-d)return n.resolve();let{cache:m,prev:u,scrollTarget:b}=n,C=a.start,R=[],x,v=1;for(let w of f.children){let fe=w.getBoundingClientRect(),ue=fe[ze[e]];m[C++]=ue,R.push(ue);let de=fe[e];x==null?x=de:de===x&&++v}let $e=R.sort()[Math.floor(R.length/2)];n.columns=v;let M=pt({axis:e,el:f});M!==n.scrollParent&&(n.scrollParent!==P&&n.scrollParent?.removeEventListener("scroll",l),M!==P&&M.addEventListener("scroll",l),n.scrollParent=M);let A=M instanceof Re?lt:M,U=dt[e],Z=0,Ke=Math.min(u.minIndex,s),Fe=Math.max(u.start,a.start);for(let w=Ke;w<Fe;w+=v)Z+=(m[w]??0)-(u.cache[w]??0);if(Z&&(A[U]+=Z),n.prev={cache:{...m},minIndex:s,start:a.start},n.syncUpdateCount++>ct)return n.resolve();let ee=f.getBoundingClientRect(),O=ee[e]+a.before,_=ee[se[e]]-a.after,ce=M instanceof Re?{[e]:0,[se[e]]:W instanceof st?W[at[e]]:W[ze[e]]}:M.getBoundingClientRect(),H=ce[e],te=ce[se[e]],re=s+o;for(let w=s;w<re;++w)m[w]??=$e;d-=(d-s)%v;let ie=(i-s)%v;for(ie&&(i+=v-ie);d-v>=s&&O>H-r;)O-=m[d-v],d-=v;for(;d<re&&O+m[d]<=H-c;)O+=m[d],d+=v;for(;i<re&&_<te+r;)_+=m[i],i+=v;for(;i-v>=s&&_-m[i-v]>=te+c;)_-=m[i-v],i-=v;let j=h({end:i,start:d});if(j.after!==a.after||j.before!==a.before||j.end!==a.end||j.start!==a.start)return n.isRendering=!0,g(j);if(!b)return n.resolve();let{index:D}=b;D=Math.min(s+o-1,Math.max(D,s)),D-=(D-s)%v;let ae=0;for(let w=s;w<D;w+=v)ae+=m[w];let q=A[U],Ve=m[D],B=ee[e]+q-H+ae-b.buffer,X=B-(te-H)+Ve+b.buffer*2;b.align==="nearest"&&(B<X?b.align="center":q>B?b.align="start":q<X&&(b.align="end")),b.align==="start"?A[U]=B:b.align==="end"?A[U]=X:b.align==="center"&&(A[U]=(B+X)/2),A[U]===q?n.resolve():l()}),p=V(({align:f="nearest",buffer:i=0,index:d})=>{n.scrollTarget={align:f,buffer:i,index:d},l()}),h=({end:f,start:i})=>{if(r===1/0)return{after:0,before:0,end:s+o,scrollTo:p,start:s};let{cache:d,columns:m}=n,u=s+o;i-=(i-s)%m,i=Math.min(u,Math.max(i,s));let b=(f-s)%m;b&&(f+=m-b),f=Math.min(u,Math.max(f,i)),f-i<=m&&(f<u?f=Math.min(u,f+m):i>s&&(i-=m));let C=0,R=0;for(let x=s;x<u;x+=m)x<i?C+=d[x]??0:x>=f&&(R+=d[x]??0);return{after:R,before:C,end:f,scrollTo:p,start:i}},[a,g]=L({after:0,before:0,end:0,scrollTo:p,start:0});return T(()=>{Object.assign(a,h({end:a.end,start:a.start}))},[o,s]),n.observer??=Me&&new Me(l),z(()=>{let{observed:f,observer:i}=n,d=t.current;i&&f!==d&&(f&&i.unobserve(f),d&&i.observe(d),n.observed=d),n.isRendering=!1,l()}),z(()=>{let{observer:f}=n;return W.addEventListener("resize",l),P.addEventListener("scroll",l),()=>{f?.disconnect(),W.removeEventListener("resize",l),P.removeEventListener("scroll",l),n.scrollParent?.removeEventListener("scroll",l)}},[n,l]),a};var{clearTimeout:Ae,clearInterval:ht,document:Le,setTimeout:Ue,setInterval:mt}=globalThis,k=10,je=e=>`rgb(${32+e*12%128}, ${32+e*23%128}, ${32+e*56%128})`,gt=({children:e})=>{if(Math.random()<.005)throw new Error("red");return z(()=>{if(Math.random()<.005)throw new Error("blue");return()=>{if(Math.random()<.005)throw new Error("yellow")}}),e},yt=Q(()=>E("div",{style:{background:"#fff9",borderRadius:"0.25rem",padding:"1rem"},children:["Portal: ",oe(le)]})),bt=Q(({x:e,y:t})=>{let r=oe(le),o=T(()=>`rgb(${128+(e-t)/k*128}, ${128+(t-e)/k*128}, ${(e+t)/k/2*256})`),s=F(void 0),[c,n]=L("black"),l=V(()=>{n(o),Ae(s.current),s.current=Ue(()=>n("black"),5e3)}),p=1+Math.floor(Math.random()*10);return y(we,{catch:h=>{n(h.message),Ae(s.current),s.current=Ue(()=>n("black"),5e3)},children:E("div",{onpointerdown:l,onpointermove:l,style:{alignItems:"center",backgroundColor:c,borderRadius:"0.25rem",display:"flex",fontSize:"0.75rem",flexDirection:"column",gap:"0.25rem",justifyContent:"center",minWidth:"0",overflow:"hidden",padding:"0.25rem",textAlign:"center",transition:c==="black"?"all 5s":""},children:[y("select",{value:(Math.floor(Math.random()*p)+1).toString(),children:Array.from({length:p},(h,a)=>y("option",{value:(a+1).toString(),children:a+1},a))}),c==="red"?"Fake Render Error":c==="blue"?"Fake After Effect Error":c==="yellow"?"Fake Before Effect Error":y(gt,{children:r}),e===0&&t===0&&!!(r%5)&&y(K,{to:Le.getElementById("portal"),children:y(yt,{})})]})})}),vt=Q(({index:e})=>E("div",{style:{borderTop:"10px solid #000",borderRight:"10px solid #000",padding:"1rem",display:"flex",alignItems:"center",justifyContent:"center",aspectRatio:"1",backgroundColor:je(e)},children:["Item ",e+1]},e)),le=xe(0),De=1e4,wt=()=>{let[e,t]=L(new Date().getSeconds()),[r,o]=L(Array.from({length:9},(h,a)=>a));z(()=>{let h=mt(()=>{t(new Date().getSeconds()),o(a=>a.toSorted(()=>Math.random()-.5))},1e3);return()=>ht(h)},[]);let s=F(null),{start:c,end:n,before:l,after:p}=Pe({containerRef:s,length:De});return E(le,{value:e,children:[y("div",{style:{boxSizing:"border-box",cursor:"crosshair",display:"grid",gap:"0.25rem",gridTemplate:`repeat(${k}, 1fr) / repeat(${k}, 1fr)`,height:"100%",padding:"0.25rem"},children:Array.from({length:k*k},(h,a)=>y(bt,{x:a%k,y:Math.floor(a/k)},a))}),y("div",{style:{boxSizing:"border-box",cursor:"crosshair",display:"grid",gap:"0.25rem",gridTemplate:"repeat(3, 1fr) / repeat(3, 1fr)",padding:"0.25rem"},children:r.map(h=>E("div",{style:{background:je(h),borderRadius:"0.25rem",color:"white",display:"flex",padding:"0.5rem"},children:[E("div",{style:{flex:"1",padding:"0.5rem"},children:["Input ",h+1]}),y("input",{style:{display:"block",padding:"0.5rem",flex:"1",borderRadius:"0.25rem",border:"0"}})]},h))}),E("div",{style:{padding:"1rem"},children:[E("div",{style:{color:"#fff",fontWeight:"bold",marginBottom:"0.5rem"},children:[De," Items"]}),y("div",{"data-list-container":"true",ref:s,style:{color:"white",paddingTop:`${l}px`,paddingBottom:`${p}px`,display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(min(200px, 50%), 1fr))",borderLeft:"10px solid #000",borderBottom:"10px solid #000"},children:Array.from({length:n-c},(h,a)=>y(vt,{index:c+a},c+a))})]}),y("button",{onclick:Be.unmount,style:{position:"fixed",bottom:"1rem",right:"1rem"},children:"Unmount"})]})},Be=Ce(Le.getElementById("root").attachShadow({mode:"open"}));Be.render(y(wt,{}));})();
