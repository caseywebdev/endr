"use strict";(()=>{var{console:$e,document:pe,queueMicrotask:Fe,Text:We}=globalThis,b=(e,t=be,r)=>({type:e,props:t,key:r}),x=b;var he=e=>e.children,Y=e=>e.children,ye=e=>(S.catch=e.catch,e.children),ge=()=>{let e=({value:t,children:r})=>{let n=S,s=P(()=>{let p={deps:new Set,value:t};return n.contexts=new Map(n.contexts).set(e,p),p});if(t!==s.value){s.value=t;for(let p of s.deps){p.state=1;let{parent:o}=p;for(;o&&o!==n&&!o.state;)o.state=2,{parent:o}=o}}return r};return e},me=e=>e==null||e===!1||e==="",be={},ve={},Be=b(ve,be),we={},He=[],Oe="http://www.w3.org/2000/svg",_e=e=>$e.error(e),qe=(e,t,r)=>{if(typeof e=="function"||e===ve)return null;if(e===we)return pe.createTextNode(t.nodeValue);let n=pe.createElementNS(e==="svg"?Oe:r.namespaceURI,e);return Ee(n,{},t),n},de=(e,t)=>t in e&&(e[t]==null||typeof e[t]!="object"),Xe=(e,t,r)=>{for(let n in t)n in r||(e[n]="");for(let n in r)e[n]=r[n]??""},Ee=(e,t,r)=>{if(e instanceof We){e.nodeValue=r.nodeValue;return}for(let n in t)n==="children"||n in r||(n==="ref"?t.ref&&(t.ref.current=null):de(e,n)?e[n]="":e.removeAttribute(n));for(let n in r)n==="children"||t[n]===r[n]||(n==="ref"?(t.ref&&(t.ref.current=null),r.ref&&(r.ref.current=e)):n==="style"&&r[n]&&typeof r[n]=="object"?Xe(e.style,t[n]&&typeof t[n]=="object"?t[n]:{},r[n]):de(e,n)?e[n]=r[n]??"":r[n]!=null?e.setAttribute(n,r[n]):e.removeAttribute(n))},S=null,O=0,_=0,R=e=>{let t=S;t.refs??=[];let r=t.refs[_++];return r||(r={current:e},t.refs.push(r)),r},T=(e,t)=>{let r=S;r.effects??=[];let n=r.effects[O++];n?(!n.deps||!t||Se(n.deps,t))&&(n.after=e,n.deps=t):r.effects.push({before:void 0,after:e,deps:t})},P=(e,t=He)=>{let r=R(null);return r.current?Se(r.current.deps,t)&&(r.current.value=e(),r.current.deps=t):r.current={value:e(),deps:t},r.current.value},K=e=>{let t=S,r=P(()=>[e,n=>{let s=typeof n=="function"?n(r[0]):n;return s===r[0]||(r[0]=s,Je(t)),s}]);return r},Se=(e,t)=>{let{length:r}=e;if(r!==t.length)return!0;for(;r--;)if(e[r]!==t[r])return!0;return!1},ee=e=>{let t=R(e);return t.current=e,P(()=>(...r)=>t.current(...r))},Ye=(e,t)=>{if(e===t)return!0;for(let r in e)if(e[r]!==t[r])return!1;for(let r in t)if(!(r in e))return!1;return!0},te=(e,t=Ye)=>(e.memo=t,e),re=e=>{let t=S,r=t.contexts?.get(e);return T(()=>{if(r)return r.deps.add(t),()=>r.deps.delete(t)},[r,t]),r?.value},Ge=(e,t)=>{for(;e.depth>t.depth;)if(e=e.parent,e===t)return 1;for(;t.depth>e.depth;)if(t=t.parent,t===e)return-1;for(;e.parent!==t.parent;)e=e.parent,t=t.parent;return e.index-t.index},Je=e=>{if(e.state===1||e.state===3)return;let{queues:t}=e,{updates:r}=t;r.length===0&&Fe(()=>{let n=r.sort(Ge);t.updates=[];for(let s=0;s<n.length;++s){let p=n[s];p.state===1&&X(p)}q(t)}),r.push(e),e.state=1},Qe=e=>{let{children:t}=e.props;if(typeof e.type=="function"){let r=[S,O,_];S=e,O=0,_=0;try{t=e.type(e.props)}catch(n){t=null,e.catch(n)}[S,O,_]=r}return me(t)?[]:Array.isArray(t)?t:[t]},Ze=e=>me(e)?Be:Array.isArray(e)?b(he,{children:e}):e&&typeof e=="object"&&Object.keys(e).length===3&&"type"in e&&(typeof e.type=="string"||typeof e.type=="function")&&"props"in e&&e.props&&typeof e.props=="object"&&"key"in e?e:b(we,{nodeValue:e}),Ce=e=>{let{child:t,state:r}=e;if(r===1)X(e);else if(r===2)for(e.state=0;t;t=t.sibling)Ce(t)},I=({child:e,node:t})=>{if(t)return[t];let r=[];for(;e;e=e.sibling)r.push(...I(e));return r},X=e=>{let{depth:t,queues:r}=e,{afterEffects:n,inserts:s,moves:p,nodeUpdates:o}=r;if(e.effects)try{for(let i=0;i<e.effects.length;++i){let f=e.effects[i];f.after&&f.before&&(f.before(),f.before=void 0)}}catch(i){e.catch(i)}let l=e.child,d=l&&new Map;for(;l;l=l.sibling)d.set(l.key??l.index,l);let y=e.node??e.parentNode,h=Qe(e);e.state=0,e.child=null;let k=e.node?null:e.prevNode;for(let i=0,f=null;i<h.length;++i){let{type:u,props:a,key:v}=Ze(h[i]),c=d?.get(v??i),M=!1,E=null,w=!1;if(c?.type===u)d.delete(v??i),c.index=i,c.sibling=null,(typeof c.type!="function"||!c.type.memo?.(c.props,a))&&(c.node&&(E=[c.node,c.props,a]),c.props=a,c.state=1),c.parentNode===y&&c.lastNode&&k!==c.prevNode&&(M=!0);else{try{c={catch:e.catch,child:null,contexts:e.contexts,depth:t+1,effects:null,index:i,key:v,lastNode:null,node:qe(u,a,y),parent:e,props:a,queues:r,refs:null,sibling:null,state:1,type:u,...u===Y?{parentNode:a.to,prevNode:a.to.lastChild}:{parentNode:y,prevNode:k}}}catch(g){e.catch(g);continue}c.node&&(w=!0)}c.parentNode===y&&(c.prevNode=k),f?f.sibling=c:e.child=c,Ce(c),M&&p.push(c),E&&o.push(E),w&&s.push(c),c.parentNode===y&&c.lastNode&&(k=c.lastNode),f=c}if(e.lastNode=e.node??k??null,d)for(let i of d.values())ne(i);e.effects&&n.push(e)},ne=(e,t=!0)=>{e.state=3;let{effects:r,child:n,node:s}=e;if(r)try{for(let o=0;o<r.length;++o){let l=r[o];l.before&&(l.before(),l.before=void 0)}}catch(o){e.catch(o)}let p=t&&!s;for(;n;n=n.sibling)ne(n,p||n.type===Y);t&&s&&e.queues.removes.unshift(s)},q=e=>{let{afterEffects:t,inserts:r,moves:n,nodeUpdates:s,removes:p}=e;for(let o=p.length-1;o>=0;--o)p[o].remove();e.removes=[];for(let o=0;o<n.length;++o){let l=n[o],{parentNode:d,prevNode:y}=l;y?y.after(...I(l)):d.prepend(...I(l))}e.moves=[];for(let o=0;o<s.length;++o)Ee(...s[o]);e.nodeUpdates=[];for(let o=0;o<r.length;++o){let{node:l,parentNode:d,prevNode:y}=r[o];y?y.after(l):d.prepend(l)}e.inserts=[];for(let o=0;o<t.length;++o){let l=t[o],d=l.effects;try{for(let y=0;y<d.length;++y){let h=d[y];h.after&&(h.before=h.after(),h.after=void 0)}}catch(y){l.catch(y)}}e.afterEffects=[]},Ne=e=>{let t={afterEffects:[],inserts:[],moves:[],nodeUpdates:[],removes:[],updates:[]},r={catch:_e,child:null,contexts:null,depth:0,effects:null,index:0,key:void 0,lastNode:null,node:null,parent:null,parentNode:e,prevNode:e.lastChild,props:{},queues:t,refs:null,sibling:null,state:1,type:he};return X(r),q(t),{render:n=>{r.props={children:n},X(r),q(t)},unmount:()=>{ne(r),q(t)}}};var{document:z,getComputedStyle:Ie,Document:ke,ResizeObserver:Me,window:Re,Window:et}=globalThis,{body:Te}=z,tt=z.scrollingElement,V=Re.visualViewport??Re,rt=10,nt={x:"clientWidth",y:"clientHeight"},ot={x:"innerWidth",y:"innerHeight"},st={x:"overflowX",y:"overflowY"},oe={x:"right",y:"bottom"},Pe={x:"width",y:"height"},ct={x:"scrollWidth",y:"scrollHeight"},lt={x:"scrollLeft",y:"scrollTop"},it=({axis:e,el:t})=>{for(;(t&&=t.parentElement)&&!(t===Te||!Te.contains(t));){if(t[ct[e]]<=t[nt[e]])continue;let r=Ie(t)[st[e]];if(r==="scroll"||r==="auto")return t}return z},ze=({axis:e="y",containerRef:t,growBuffer:r=200,length:n=0,minIndex:s=0,shrinkBuffer:p=r+200})=>{let{current:o}=R({cache:{},columns:1,isRendering:!1,observed:null,observer:null,prev:{cache:{},minIndex:s,start:s},scrollParent:null,scrollTarget:null,syncUpdateCount:0,resolve:()=>{o.scrollTarget=null,o.syncUpdateCount=0}}),l=ee(()=>{if(o.isRendering)return;let i=t.current,{end:f,start:u}=h;if(!i||u===f||i.children.length!==f-u)return o.resolve();let{cache:a,prev:v,scrollTarget:c}=o,M=h.start,E=[],w,g=1;for(let m of i.children){let fe=m.getBoundingClientRect(),ae=fe[Pe[e]];a[M++]=ae,E.push(ae);let ue=fe[e];w==null?w=ue:ue===w&&++g}let Le=E.sort()[Math.floor(E.length/2)];o.columns=g;let N=it({axis:e,el:i});N!==o.scrollParent&&(o.scrollParent!==z&&o.scrollParent?.removeEventListener("scroll",l),N!==z&&N.addEventListener("scroll",l),o.scrollParent=N);let j=N instanceof ke?tt:N,U=lt[e],G=0,xe=Math.min(v.minIndex,s),Ke=Math.max(v.start,h.start);for(let m=xe;m<Ke;m+=g)G+=(a[m]??0)-(v.cache[m]??0);if(G&&(j[U]+=G),o.prev={cache:{...a},minIndex:s,start:h.start},o.syncUpdateCount++>rt)return o.resolve();let J=i.getBoundingClientRect(),$=J[e]+h.before,F=J[oe[e]]-h.after,ce=N instanceof ke?{[e]:0,[oe[e]]:V instanceof et?V[ot[e]]:V[Pe[e]]}:N.getBoundingClientRect(),W=ce[e],Q=ce[oe[e]],Z=s+n;for(let m=s;m<Z;++m)a[m]??=Le;u-=(u-s)%g;let le=(f-s)%g;for(le&&(f+=g-le);u-g>=s&&$>W-r;)$-=a[u-g],u-=g;for(;u<Z&&$+a[u]<=W-p;)$+=a[u],u+=g;for(;f<Z&&F<Q+r;)F+=a[f],f+=g;for(;f-g>=s&&F-a[f-g]>=Q+p;)F-=a[f-g],f-=g;let D=y({end:f,start:u});if(D.after!==h.after||D.before!==h.before||D.end!==h.end||D.start!==h.start)return o.isRendering=!0,k(D);if(!c)return o.resolve();let{index:A}=c;A=Math.min(s+n-1,Math.max(A,s)),A-=(A-s)%g;let ie=0;for(let m=s;m<A;m+=g)ie+=a[m];let B=j[U],Ve=a[A],L=J[e]+B-W+ie-c.buffer,H=L-(Q-W)+Ve+c.buffer*2;c.align==="nearest"&&(L<H?c.align="center":B>L?c.align="start":B<H&&(c.align="end")),c.align==="start"?j[U]=L:c.align==="end"?j[U]=H:c.align==="center"&&(j[U]=(L+H)/2),j[U]===B?o.resolve():l()}),d=ee(({align:i="nearest",buffer:f=0,index:u})=>{o.scrollTarget={align:i,buffer:f,index:u},l()}),y=({end:i,start:f})=>{if(r===1/0)return{after:0,before:0,end:s+n,scrollTo:d,start:s};let{cache:u,columns:a}=o,v=s+n;f-=(f-s)%a,f=Math.min(v,Math.max(f,s));let c=(i-s)%a;c&&(i+=a-c),i=Math.min(v,Math.max(i,f)),i-f<=a&&(i<v?i=Math.min(v,i+a):f>s&&(f-=a));let M=0,E=0;for(let w=s;w<v;w+=a)w<f?M+=u[w]??0:w>=i&&(E+=u[w]??0);return{after:E,before:M,end:i,scrollTo:d,start:f}},[h,k]=K({after:0,before:0,end:0,scrollTo:d,start:0});return P(()=>{Object.assign(h,y({end:h.end,start:h.start}))},[n,s]),o.observer??=Me&&new Me(l),T(()=>{let{observed:i,observer:f}=o,u=t.current;f&&i!==u&&(i&&f.unobserve(i),u&&f.observe(u),o.observed=u),o.isRendering=!1,l()}),T(()=>{let{observer:i}=o;return V.addEventListener("resize",l),z.addEventListener("scroll",l),()=>{i?.disconnect(),V.removeEventListener("resize",l),z.removeEventListener("scroll",l),o.scrollParent?.removeEventListener("scroll",l)}},[o,l]),h};var{clearTimeout:je,document:Ae,setTimeout:Ue,setInterval:ft}=globalThis,C=10,at=({children:e})=>{if(Math.random()<.005)throw new Error("red");return T(()=>{if(Math.random()<.005)throw new Error("blue");return()=>{if(Math.random()<.5)throw new Error("yellow")}}),e},ut=te(()=>x("div",{style:{background:"#fff9",borderRadius:"0.25rem",padding:"1rem"},children:["Portal: ",re(se)]})),pt=te(({x:e,y:t})=>{let r=re(se)??0,n=P(()=>`rgb(${128+(e-t)/C*128}, ${128+(t-e)/C*128}, ${(e+t)/C/2*256})`),s=R(void 0),[p,o]=K("black");return b(ye,{catch:l=>{o(l.message),je(s.current),s.current=Ue(()=>o("black"),5e3)},children:x("div",{onpointermove:()=>{o(n),je(s.current),s.current=Ue(()=>o("black"),5e3)},ontouchmove:l=>l.preventDefault(),style:{alignItems:"center",backgroundColor:p,borderRadius:"0.25rem",display:"flex",fontSize:"0.75rem",justifyContent:"center",minWidth:"0",overflow:"hidden",padding:"0.25rem",textAlign:"center",transition:p==="black"?"all 5s":""},children:[p==="red"?"Fake Render Error":p==="blue"?"Fake After Effect Error":p==="yellow"?"Fake Before Effect Error":b(at,{children:r}),e===0&&t===0&&!!(r%5)&&b(Y,{to:Ae.getElementById("portal"),children:b(ut,{})})]})})}),se=ge(),dt=()=>{let[e,t]=K(new Date().getSeconds());T(()=>{ft(()=>t(new Date().getSeconds()),1e3)},[]);let r=R(null),{start:n,end:s,before:p,after:o}=ze({containerRef:r,length:1e4});return x(se,{value:e,children:[b("div",{style:{cursor:"crosshair",display:"grid",gap:"0.25rem",gridTemplate:`repeat(${C}, 1fr) / repeat(${C}, 1fr)`,height:"100%",padding:"0.25rem"},children:Array.from({length:C*C},(l,d)=>b(pt,{x:d%C,y:Math.floor(d/C)},d))}),b("div",{ref:r,style:{color:"white",paddingTop:`${p}px`,paddingBottom:`${o}px`},children:Array.from({length:s-n},(l,d)=>x("div",{style:{borderTop:"1px solid #222",padding:"1rem"},children:["Item ",d+n+1]},d+n))}),b("button",{onclick:De.unmount,style:{position:"fixed",bottom:"1rem",right:"1rem"},children:"Unmount"})]})},De=Ne(Ae.getElementById("root"));De.render(b(dt,{}));})();
